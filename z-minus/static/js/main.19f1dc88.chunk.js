(this["webpackJsonpz-minus"]=this["webpackJsonpz-minus"]||[]).push([[0],{148:function(t,e,i){t.exports=i(157)},153:function(t,e,i){},155:function(t,e,i){},157:function(t,e,i){"use strict";i.r(e);var n=i(41),o=i.n(n),r=i(146),s=i.n(r),a=(i(153),i(31)),h=i(147),l=(i(155),i(79)),c=i(80),u=function(){function t(e,i,n,o){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;Object(l.a)(this,t),this.owner=e,this.isHome=i,this.coords=void 0,this.mesh=void 0,void 0===r?r=-(n+o):n+o+r!==0&&console.error("Attempting to create an invalid Tile",{q:n,r:o,s:r}),this.coords=new a.i(n,o,r),this.mesh=void 0}return Object(c.a)(t,[{key:"generate",value:function(e,i,n){t.mesh||(t.mesh=t.generateMesh(e,i));var o=this.coords,r=o.x,s=o.y,a=o.z,h=t.mesh.createInstance("tileMesh/".concat(r,"/").concat(s,"/").concat(a));h.position.copyFrom(n),h.isVisible=!0,this.mesh=h}},{key:"conqueror",value:function(t,e){var i=this,n=t.filter((function(t){return t.tile===i}));if(n.length>0)for(var o=Math.max(2,2*n.length/3),r=function(t){var i=e[t];if(n.filter((function(t){return t.owner===i})).length>=o)return{v:i}},s=0;s<e.length;s++){var a=r(s);if("object"===typeof a)return a.v}}},{key:"updateDrawn",value:function(t){}},{key:"updateState",value:function(t,e,i){this.mesh.instancedBuffers.color=this.isHome?this.owner.homeTileColor:this.owner.tileColor;var n=this.conqueror(e,i);if(n){this.owner=n;for(var o=0;o<e.length;o++){var r=e[o];r.tile===this&&r.owner!==n&&(r.active=!1)}}this.owner.resourceCount+=1*t/1e3}},{key:"equals",value:function(t){return this.coords.equals(t.coords)}}],[{key:"distBetween",value:function(t,e){var i=t.coords.subtract(e.coords),n=i.x,o=i.y,r=i.z;return.5*(Math.abs(n)+Math.abs(o)+Math.abs(r))}},{key:"roundCoords",value:function(t,e){var i=-t-e,n=Math.round(t),o=Math.round(e),r=Math.round(i),s=Math.abs(t-n),a=Math.abs(e-o),h=Math.abs(i-r);return s>Math.max(a,h)?{q:-o-r,r:o}:a>h?{q:n,r:-n-r}:{q:n,r:o}}},{key:"generateMesh",value:function(t,e){var i=new a.h("tileMeshMaterial",t);i.specularColor=new a.b(.5,.6,.87);var n=a.f.CreateDisc("tileMesh",{radius:e,tessellation:6},t);return n.rotation.x=.5*Math.PI,n.material=i,n.isVisible=!1,n.registerInstancedBuffer("color",4),n.instancedBuffers.color=new a.c(1,1,1,1),n}}]),t}();u.directions=[new a.i(0,1,-1),new a.i(1,0,-1),new a.i(1,-1,0),new a.i(0,-1,1),new a.i(-1,0,1),new a.i(-1,1,0)],u.mesh=void 0;var v=Math.sqrt(3),d=function(){function t(e,i,n){Object(l.a)(this,t),this.radius=e,this.players=i,this.tiles=void 0,this.tileList=void 0,this.tiles=[],this.tileList=[];for(var o=e,r=-o;r<=o;r++){this.tiles[r+o]=[];for(var s=-o;s<=o;s++){var a=-(r+s);if(-o<=a&&a<=o&&n(r,s,a)){var h=0===r&&Math.abs(s)===o,c=i[h?s===o?1:2:0],v=new u(c,h,r,s);this.tiles[r+o][s+o]=v,this.tileList.push(v)}}}}return Object(c.a)(t,[{key:"generate",value:function(t){for(var e=0;e<this.tileList.length;e++){var i=this.tileList[e];i.generate(t,1.96,this.tileToPos(i))}}},{key:"updateDrawn",value:function(t){for(var e=0;e<this.tileList.length;e++)this.tileList[e].updateDrawn(t)}},{key:"updateState",value:function(t,e){for(var i=0;i<this.tileList.length;i++)this.tileList[i].updateState(t,e,this.players)}},{key:"tile",value:function(t,e){var i=this.radius;if(-i<=t&&t<=i&&-i<=e&&e<=i)return this.tiles[t+i][e+i]}},{key:"tileToPos",value:function(t){var e=t.coords,i=e.x,n=e.y;return new a.i(1.5*i*2,0,v*(.5*i+n)*2)}},{key:"posToTile",value:function(t){var e=t.x/2,i=t.z/2,n=u.roundCoords(2/3*e,(v*i-e)/3),o=n.q,r=n.r;return this.tile(o,r)}},{key:"neighbours",value:function(t){var e=this,i=t.coords,n=i.x,o=i.y;return u.directions.map((function(t){return e.tile(n+t.x,o+t.y)})).filter((function(t){return!!t}))}}]),t}(),f=i(89),w=i.n(f),p=w.a.mark(m),g=w.a.mark(y);function m(t,e){var i,n;return w.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:i=e.subtract(t.position).normalize(),n=i.clone();case 2:if(!(a.i.Dot(i,n)>0)){o.next=9;break}return i.normalize().scaleToRef(1,t.velocity),void(o.next=6);case 6:e.subtractToRef(t.position,n),o.next=2;break;case 9:case"end":return o.stop()}}),p)}function y(t){var e;return w.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:e=0;case 1:if(!(e<t)){i.next=8;break}return i.t0=e,void(i.next=5);case 5:e=i.t0+=i.sent,i.next=1;break;case 8:case"end":return i.stop()}}),g)}var b=w.a.mark(k);function x(t){if(t.length>0)return t[(e=t.length,Math.floor(Math.random()*e))];var e}function k(t,e){var i,n,o,r;return w.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return i=e.posToTile(t.position),n=i&&e.neighbours(i),(o=n&&x(n))||console.warn("ran out of neighbours",(null===n||void 0===n?void 0:n.length)||0),r=o||t.owner.homeTile,s.delegateYield(m(t,e.tileToPos(r)),"t0",7);case 7:return s.delegateYield(y(100),"t1",8);case 8:s.next=0;break;case 10:case"end":return s.stop()}}),b)}var C=function(){function t(e,i,n,o){Object(l.a)(this,t),this.id=e,this.owner=i,this.tile=n,this.position=o,this.mesh=void 0,this.ai=void 0,this.active=void 0,this.velocity=void 0,this.targetAngle=void 0,this.active=!0,this.velocity=new a.i,this.targetAngle=0,this.mesh=void 0,this.ai=void 0}return Object(c.a)(t,[{key:"generate",value:function(e,i){t.mesh||(t.mesh=t.generateMesh(e,.75,.1));var n=t.mesh.createInstance("unitMesh/".concat(this.id));n.isVisible=!0,n.instancedBuffers.color=this.owner.unitColor,n.position.copyFrom(this.position),this.mesh=n,this.ai=k(this,i)}},{key:"updateDrawn",value:function(t){this.active&&(this.velocity.scaleAndAddToRef(t/1e3,this.position),this.mesh.position.copyFrom(this.position),this.mesh.position.y=.05+.01*this.owner.id,this.mesh.rotation.y=.9*this.mesh.rotation.y+.1*this.targetAngle)}},{key:"updateState",value:function(t,e){if(!this.active)return this.mesh.instancedBuffers.color=this.owner.deadUnitColor,this.mesh.position.y-=.05,void(this.ai=void 0);this.ai.next(t),this.tile=e.posToTile(this.position)||this.owner.homeTile,this.targetAngle=Math.PI/6+Math.acos(a.i.Dot(a.i.Forward(),this.velocity)/this.velocity.length())}}],[{key:"generateMesh",value:function(t,e,i){var n=new a.h("unitMeshMaterial",t);n.specularColor=new a.b(.8,.8,.9);var o=a.f.CreateCylinder("unitMesh",{diameter:e,height:i,tessellation:3,enclose:!0},t);return o.material=n,o.isVisible=!1,o.registerInstancedBuffer("color",4),o.instancedBuffers.color=new a.c(1,1,1,1),o}}]),t}();C.mesh=void 0,C.cost=10;var M,T,U,S,A=function(){function t(e,i,n,o){Object(l.a)(this,t),this.id=e,this.name=i,this.homeTile=void 0,this.tileColor=void 0,this.homeTileColor=void 0,this.unitColor=void 0,this.deadUnitColor=void 0,this.resourceCount=void 0,this.tileColor=t.color(n,.4*o,.8),this.homeTileColor=t.color(n,.7*o,.6),this.unitColor=t.color(n,.9*o,.95),this.deadUnitColor=t.color(n,.4*o,.3,.3),this.resourceCount=0,this.homeTile=void 0}return Object(c.a)(t,[{key:"generate",value:function(t,e){var i=this;this.homeTile=e.tileList.find((function(t){return t.owner===i&&t.isHome}))}},{key:"updateState",value:function(t,e){this.resourceCount>C.cost&&(this.resourceCount-=C.cost,e.spawnUnit(this,this.homeTile))}},{key:"isAlive",value:function(){return this.homeTile.owner===this}},{key:"statusDisplayText",value:function(t){var e=this,i=t.filter((function(t){return t.owner===e})).length;return"".concat(this.name,": $").concat(Math.floor(this.resourceCount),", ").concat(i," unit(s)")}}],[{key:"color",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=new a.b;a.b.HSVtoRGBToRef(t,e,i,o);var r=o.r,s=o.g,h=o.b;return new a.c(r,s,h,n)}}]),t}(),z=function(){function t(){Object(l.a)(this,t),this.players=void 0,this.board=void 0,this.allUnits=void 0,this.activeUnits=void 0,this.scene=void 0,this.winner=void 0;var e=new A(0,"Gaia",180,.01),i=new A(1,"Green",120,1),n=new A(2,"Red",0,1);this.players=[e,i,n],this.board=new d(2,this.players,(function(){return!0})),this.allUnits=[],this.activeUnits=[],this.scene=void 0,this.winner=void 0}return Object(c.a)(t,[{key:"generate",value:function(t){this.board.generate(t);for(var e=0;e<this.activeUnits.length;e++)this.activeUnits[e].generate(t,this.board);for(var i=0;i<this.players.length;i++){this.players[i].generate(t,this.board)}this.scene=t}},{key:"spawnUnit",value:function(t,e){var i=this.board.tileToPos(e),n=new C(this.allUnits.length,t,e,i);this.scene&&n.generate(this.scene,this.board),this.allUnits.push(n),this.activeUnits.push(n)}},{key:"updateDrawn",value:function(t){if(this.scene){this.board.updateDrawn(t);for(var e=0;e<this.activeUnits.length;e++)this.activeUnits[e].updateDrawn(t)}}},{key:"updateState",value:function(t){this.board.updateState(t,this.activeUnits);for(var e=0;e<this.activeUnits.length;e++)this.activeUnits[e].updateState(t,this.board);this.activeUnits=this.allUnits.filter((function(t){return t.active}));for(var i=1;i<=2;i++){var n=this.players[i];n.updateState(t,this),n.isAlive()||(this.winner=this.players[3-i])}}},{key:"running",value:function(){return void 0===this.winner}}]),t}(),D=i(106),j=new z,q=function(t){t.ambientColor=new a.b(1,1,1);var e=new a.a("camera1",0,0,10,new a.i(0,6,16),t);e.setTarget(a.i.Zero());var i=t.getEngine().getRenderingCanvas();e.attachControl(i,!0);for(var n=[new a.e("light",new a.i(0,1,-2),t),new a.e("light",new a.i(1,1,1),t),new a.e("light",new a.i(-1,1,1),t)],o=0;o<n.length;o++)n[o].intensity=.375;j.generate(t),j.spawnUnit(j.players[1],j.board.tile(0,2)),j.spawnUnit(j.players[2],j.board.tile(0,-2));var r=D.a.CreateFullscreenUI("UI");(M=new D.b).text="Player1: $0",M.color="white",M.fontSize=24,M.textHorizontalAlignment=0,M.textVerticalAlignment=1,(T=new D.b).text="Player2: $0",T.color="white",T.fontSize=24,T.textHorizontalAlignment=1,T.textVerticalAlignment=1,(U=new D.b).text="FPS: 0",U.color="white",U.fontSize=24,U.textHorizontalAlignment=1,U.textVerticalAlignment=0,(S=new D.b).text="",S.color="white",S.fontSize=72,S.textHorizontalAlignment=2,S.textVerticalAlignment=2,r.addControl(M),r.addControl(T),r.addControl(U),r.addControl(S)},B=0,L=!0,O=function(t){if(U&&(U.text="FPS: ".concat(Math.round(t.getEngine().getFps()))),L){var e,i=t.getEngine().getDeltaTime();if(j.updateDrawn(i),(B+=i)>100)if(j.updateState(B),B=0,!j.running())if(L=!1,j.updateState(0),S)S.text="".concat(null===(e=j.winner)||void 0===e?void 0:e.name," wins!");M&&(M.text=j.players[1].statusDisplayText(j.activeUnits)),T&&(T.text=j.players[2].statusDisplayText(j.activeUnits))}};var P=function(){return o.a.createElement("div",{className:"fullscreen"},o.a.createElement(h.a,{antialias:!0,onSceneReady:q,onRender:O,id:"game-canvas"}))};s.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(P,null)),document.getElementById("root"))}},[[148,1,2]]]);
//# sourceMappingURL=main.19f1dc88.chunk.js.map