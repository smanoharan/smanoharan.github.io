(this["webpackJsonpz-minus"]=this["webpackJsonpz-minus"]||[]).push([[0],{34:function(e,t,i){e.exports=i(45)},39:function(e,t,i){},41:function(e,t,i){},43:function(e,t,i){},44:function(e,t,i){},45:function(e,t,i){"use strict";i.r(t);var n=i(9),s=i.n(n),a=i(31),r=i.n(a),o=(i(39),i(10)),l=i(32),h=(i(41),{minDurationState:25,tileSize:2,drawnTileSize:1.96,unitCost:10,unitMaxSpeed:4,resourcesRate:2}),u=i(18),c=i(19),v=i(21),f=i.n(v),d=f.a.mark(m);function m(e,t){var i,n;return f.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:i=t.subtract(e.position).normalize(),n=i.clone();case 2:if(!(o.j.Dot(i,n)>0)){s.next=9;break}return i.normalize().scaleToRef(h.unitMaxSpeed,e.velocity),void(s.next=6);case 6:t.subtractToRef(e.position,n),s.next=2;break;case 9:e.velocity.scaleInPlace(0);case 10:case"end":return s.stop()}}),d)}var g,p=f.a.mark(y);function w(e){if(e.length>0)return e[(t=e.length,Math.floor(Math.random()*t))];var t}function y(e,t){var i,n,s,a;return f.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=t.posToTile(e.position),n=i&&t.neighbours(i),(s=n&&w(n))||console.warn("ran out of neighbours",(null===n||void 0===n?void 0:n.length)||0),a=s||e.owner.homeTile,r.delegateYield(m(e,a.toPos()),"t0",7);case 7:r.next=0;break;case 9:case"end":return r.stop()}}),p)}!function(e){e[e.active=0]="active",e[e.dead=1]="dead",e[e.won=2]="won",e[e.lost=3]="lost"}(g||(g={}));var b=function(){function e(t,i,n,s,a){Object(u.a)(this,e),this.game=t,this.id=i,this.owner=n,this.tile=s,this.position=a,this.mesh=void 0,this.ai=void 0,this.state=void 0,this.velocity=void 0,this.targetAngle=void 0,this.state=g.active,this.velocity=new o.j,this.targetAngle=0,this.mesh=void 0,this.ai=void 0}return Object(c.a)(e,[{key:"generate",value:function(t){e.mesh||(e.mesh=e.generateMesh(t,.75,.1));var i=e.mesh.createInstance("unitMesh/".concat(this.id));i.isVisible=!0,i.instancedBuffers.color=this.owner.unitColor,i.position.copyFrom(this.position),this.mesh=i,this.ai=y(this,this.game.board)}},{key:"updateDrawn",value:function(e){var t,i,n,s=.05+.01*this.owner.id;switch(this.state){case g.active:this.velocity.scaleAndAddToRef(e/1e3,this.position),this.mesh.position.copyFrom(this.position),this.mesh.position.y=s;var a=this.mesh.rotation.y;this.mesh.rotation.y=(t=a,i=this.targetAngle,t*(n=.1)+i*(1-n));break;case g.won:var r=this.id%4*2-3;this.mesh.rotation.y+=r*e/1e3;var o=.2*(this.id%3+1)*(.8+Math.sin(this.mesh.rotation.y));this.mesh.position.y=s+Math.max(0,o)}}},{key:"updateState",value:function(e){if(this.state===g.active&&(this.ai.next(e),this.tile=this.game.board.posToTile(this.position)||this.owner.homeTile,this.velocity.length()>.1)){var t=o.j.Dot(o.j.Forward(),this.velocity);this.targetAngle=Math.PI/6+Math.acos(t/this.velocity.length())}}},{key:"isAlive",value:function(){return this.state===g.active||this.state===g.won}},{key:"setState",value:function(e){if(this.state!==e){switch(e){case g.won:this.velocity.scaleInPlace(0);break;case g.dead:case g.lost:this.mesh.instancedBuffers.color=this.owner.deadUnitColor,this.ai=void 0,this.velocity.scaleInPlace(0),this.mesh.position.y=.05+.001*this.owner.id}this.state=e}}}],[{key:"generateMesh",value:function(e,t,i){var n=new o.i("unitMeshMaterial",e);n.specularColor=new o.b(.8,.8,.9);var s=o.g.CreateCylinder("unitMesh",{diameter:t,height:i,tessellation:3,enclose:!0},e);return s.material=n,s.isVisible=!1,s.registerInstancedBuffer("color",4),s.instancedBuffers.color=new o.c(1,1,1,1),s}}]),e}();b.mesh=void 0;var k=function(){function e(t,i,n,s,a){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0;Object(u.a)(this,e),this.game=t,this.owner=i,this.isHome=n,this.coords=void 0,this.mesh=void 0,void 0===r?r=-(s+a):s+a+r!==0&&console.error("Attempting to create an invalid Tile",{q:s,r:a,s:r}),this.coords=new o.j(s,a,r),this.mesh=void 0}return Object(c.a)(e,[{key:"generate",value:function(t){e.mesh||(e.mesh=e.generateMesh(t,h.drawnTileSize));var i=this.coords,n=i.x,s=i.y,a=i.z,r=e.mesh.createInstance("tileMesh/".concat(n,"/").concat(s,"/").concat(a));r.position.copyFrom(this.toPos()),r.isVisible=!0,this.mesh=r}},{key:"conqueror",value:function(e,t){var i=this,n=e.filter((function(e){return e.tile===i}));if(n.length>0)for(var s=Math.max(2,2*n.length/3),a=function(e){var i=t[e];if(n.filter((function(e){return e.owner===i})).length>=s)return{v:i}},r=0;r<t.length;r++){var o=a(r);if("object"===typeof o)return o.v}}},{key:"updateDrawn",value:function(e){}},{key:"updateState",value:function(e){var t=this.conqueror(this.game.aliveUnits,this.game.players);if(t){this.owner=t;for(var i=0;i<this.game.aliveUnits.length;i++){var n=this.game.aliveUnits[i];n.tile===this&&n.owner!==t&&n.setState(g.dead)}}this.mesh.instancedBuffers.color=this.isHome?this.owner.homeTileColor:this.owner.tileColor,this.owner.resourceCount+=e*h.resourcesRate/1e3}},{key:"equals",value:function(e){return this.coords.equals(e.coords)}},{key:"toPos",value:function(){var e=this.coords,t=e.x,i=e.y;return new o.j(1.5*t*h.tileSize,0,M*(.5*t+i)*h.tileSize)}}],[{key:"distBetween",value:function(e,t){var i=e.coords.subtract(t.coords),n=i.x,s=i.y,a=i.z;return.5*(Math.abs(n)+Math.abs(s)+Math.abs(a))}},{key:"roundCoords",value:function(e,t){var i=-e-t,n=Math.round(e),s=Math.round(t),a=Math.round(i),r=Math.abs(e-n),o=Math.abs(t-s),l=Math.abs(i-a);return r>Math.max(o,l)?{q:-s-a,r:s}:o>l?{q:n,r:-n-a}:{q:n,r:s}}},{key:"generateMesh",value:function(e,t){var i=new o.i("tileMeshMaterial",e);i.specularColor=new o.b(.5,.6,.87);var n=o.g.CreateDisc("tileMesh",{radius:t,tessellation:6,sideOrientation:o.f.DOUBLESIDE},e);return n.rotation.x=.5*Math.PI,n.material=i,n.isVisible=!1,n.registerInstancedBuffer("color",4),n.instancedBuffers.color=new o.c(1,1,1,1),n}}]),e}();k.directions=[new o.j(0,1,-1),new o.j(1,0,-1),new o.j(1,-1,0),new o.j(0,-1,1),new o.j(-1,0,1),new o.j(-1,1,0)],k.mesh=void 0;var M=Math.sqrt(3),j=function(){function e(t,i,n){Object(u.a)(this,e),this.game=t,this.radius=i,this.tiles=void 0,this.tileList=void 0,this.tiles=[],this.tileList=[];for(var s=i,a=-s;a<=s;a++){this.tiles[a+s]=[];for(var r=-s;r<=s;r++){var o=-(a+r);if(-s<=o&&o<=s&&n(a,r,o)){var l=0===a&&Math.abs(r)===s,h=t.players[l?r===s?1:2:0],c=new k(t,h,l,a,r);this.tiles[a+s][r+s]=c,this.tileList.push(c)}}}}return Object(c.a)(e,[{key:"generate",value:function(e){for(var t=0;t<this.tileList.length;t++){this.tileList[t].generate(e)}}},{key:"updateDrawn",value:function(e){for(var t=0;t<this.tileList.length;t++)this.tileList[t].updateDrawn(e)}},{key:"updateState",value:function(e){for(var t=0;t<this.tileList.length;t++)this.tileList[t].updateState(e)}},{key:"tile",value:function(e,t){var i=this.radius;if(-i<=e&&e<=i&&-i<=t&&t<=i)return this.tiles[e+i][t+i]}},{key:"neighbours",value:function(e){var t=this,i=e.coords,n=i.x,s=i.y;return k.directions.map((function(e){return t.tile(n+e.x,s+e.y)})).filter((function(e){return!!e}))}},{key:"posToTile",value:function(e){var t=e.x/h.tileSize,i=e.z/h.tileSize,n=k.roundCoords(2/3*t,(S*i-t)/3),s=n.q,a=n.r;return this.tile(s,a)}}]),e}(),S=Math.sqrt(3);function C(e,t){return e.filter(t).length}var T=function(){function e(t,i,n,s,a){Object(u.a)(this,e),this.game=t,this.id=i,this.name=n,this.tileColor=void 0,this.homeTileColor=void 0,this.unitColor=void 0,this.deadUnitColor=void 0,this.homeTile=void 0,this.resourceCount=void 0,this.tileColor=e.color(s,.4*a,.8),this.homeTileColor=e.color(s,.7*a,.6),this.unitColor=e.color(s,.9*a,.95),this.deadUnitColor=e.color(s,.4*a,.3,.3),this.resourceCount=0,this.homeTile=void 0}return Object(c.a)(e,[{key:"generate",value:function(e){var t=this;this.homeTile=this.game.board.tileList.find((function(e){return e.owner===t&&e.isHome}))}},{key:"updateState",value:function(e){for(;this.resourceCount>h.unitCost;)this.resourceCount-=h.unitCost,this.game.spawnUnit(this,this.homeTile)}},{key:"isAlive",value:function(){return this.homeTile.owner===this}},{key:"statusDisplayText",value:function(e){var t=this,i=Math.floor(this.resourceCount),n=C(e.board.tileList,(function(e){return e.owner===t})),s=C(e.aliveUnits,(function(e){return e.owner===t}));return"".concat(this.name,": $").concat(i,", ").concat(n," tile(s), ").concat(s," unit(s)")}}],[{key:"color",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=new o.b;o.b.HSVtoRGBToRef(e,t,i,s);var a=s.r,r=s.g,l=s.b;return new o.c(a,r,l,n)}}]),e}(),U=function(){function e(){Object(u.a)(this,e),this.players=void 0,this.board=void 0,this.allUnits=void 0,this.aliveUnits=void 0,this.scene=void 0,this.winner=void 0,this.listeners=void 0,this.elapsedMillisState=0;var t=new T(this,0,"Gaia",180,.01),i=new T(this,1,"Green",120,1),n=new T(this,2,"Red",0,1);this.players=[t,i,n],this.board=new j(this,2,(function(){return!0})),this.allUnits=[],this.aliveUnits=[],this.scene=void 0,this.winner=void 0,this.listeners=[]}return Object(c.a)(e,[{key:"generate",value:function(e){this.board.generate(e);for(var t=0;t<this.aliveUnits.length;t++)this.aliveUnits[t].generate(e);for(var i=0;i<this.players.length;i++){this.players[i].generate(e)}this.scene=e}},{key:"spawnUnit",value:function(e,t){var i=this.allUnits.length,n=new b(this,i,e,t,t.toPos());this.scene&&n.generate(this.scene),this.allUnits.push(n),this.aliveUnits.push(n)}},{key:"update",value:function(e){this.updateDrawn(e),this.elapsedMillisState+=e,this.running()&&this.elapsedMillisState>=h.minDurationState&&(this.updateState(this.elapsedMillisState),this.elapsedMillisState=0)}},{key:"updateDrawn",value:function(e){if(this.scene){this.board.updateDrawn(e);for(var t=0;t<this.aliveUnits.length;t++)this.aliveUnits[t].updateDrawn(e)}}},{key:"updateState",value:function(e){this.board.updateState(e);for(var t=0;t<this.aliveUnits.length;t++)this.aliveUnits[t].updateState(e);this.aliveUnits=this.allUnits.filter((function(e){return e.isAlive()}));for(var i=1;i<=2;i++){var n=this.players[i];if(n.updateState(e),!n.isAlive()){var s=this.players[3-i];this.finishGame(s)}}this.notifyListeners()}},{key:"addListenerEffect",value:function(e){var t=this;return this.listeners.push(e),function(){t.listeners=t.listeners.filter((function(t){return t!==e}))}}},{key:"notifyListeners",value:function(){for(var e=0;e<this.listeners.length;e++){var t=this.listeners[e];t.current&&t.current(this)}}},{key:"running",value:function(){return void 0===this.winner}},{key:"finishGame",value:function(e){this.winner=e;for(var t=0;t<this.aliveUnits.length;t++){var i=this.aliveUnits[t];i.setState(i.owner===e?g.won:g.lost)}}}]),e}(),x=i(33),O=(i(43),function(e){var t=e.outRef,i=Object(n.useRef)(null),a=Object(n.useRef)(null),r=Object(n.useRef)(null),o=Object(n.useCallback)((function(e){if(e.scene&&i.current){var t=Math.round(e.scene.getEngine().getFps());i.current.innerText="FPS: ".concat(t)}var n=Object(x.a)(e.players,3),s=n[1],o=n[2];a.current&&s&&(a.current.innerText=s.statusDisplayText(e)),r.current&&o&&(r.current.innerText=o.statusDisplayText(e))}),[i,a,r]);return Object(n.useEffect)((function(){t&&(t.current=o)}),[t,o]),s.a.createElement("div",{className:"stats"},s.a.createElement("div",{className:"stats-fps",ref:i}),s.a.createElement("div",{className:"stats-p1",ref:a}),s.a.createElement("div",{className:"stats-p2",ref:r}))}),E=(i(44),function(e){var t=e.onGetMessage,i=e.outRef,a=Object(n.useRef)(null),r=Object(n.useCallback)((function(e){a.current&&(a.current.innerText=t(e))}),[a,t]);return Object(n.useEffect)((function(){i.current=r}),[i,r]),s.a.createElement("div",{className:"alert",ref:a})}),R=new U,D=function(e){e.ambientColor=new o.b(1,1,1);var t=new o.a("camera1",0,0,10,new o.j(0,6,16),e);t.setTarget(o.j.Zero());var i=e.getEngine().getRenderingCanvas();t.attachControl(i,!0);for(var n=[new o.e("light",new o.j(0,1,-2),e),new o.e("light",new o.j(1,1,1),e),new o.e("light",new o.j(-1,1,1),e)],s=0;s<n.length;s++)n[s].intensity=.4;R.generate(e),R.spawnUnit(R.players[1],R.board.tile(0,2)),R.spawnUnit(R.players[2],R.board.tile(0,-2))};var L=function(){var e=Object(n.useRef)(void 0),t=Object(n.useRef)(void 0);return Object(n.useEffect)((function(){return R.addListenerEffect(e)}),[e]),Object(n.useEffect)((function(){return R.addListenerEffect(t)}),[t]),s.a.createElement("div",{className:"fullscreen"},s.a.createElement(O,{outRef:e}),s.a.createElement(E,{onGetMessage:function(e){return e.winner?"".concat(e.winner.name," wins!"):""},outRef:t}),s.a.createElement(l.a,{antialias:!0,onSceneReady:D,onRender:function(e){var t=e.getEngine().getDeltaTime();R.update(t)},id:"game-canvas"}))};r.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(L,null)),document.getElementById("root"))}},[[34,1,2]]]);
//# sourceMappingURL=main.f5e37c09.chunk.js.map