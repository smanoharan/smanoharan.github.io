(this["webpackJsonpz-minus"]=this["webpackJsonpz-minus"]||[]).push([[0],{217:function(e,t,i){var n=i(233),a=["simulateSingle","simulateTeam"];e.exports=function(){var e=new Worker(i.p+"3c5bf9a370ecfce1e133.worker.js",{name:"[hash].worker.js"});return n(e,a),e}},219:function(e,t,i){e.exports=i(234)},224:function(e,t,i){},226:function(e,t,i){},231:function(e,t,i){},232:function(e,t,i){},234:function(e,t,i){"use strict";i.r(t);var n=i(20),a=i.n(n),r=i(213),s=i.n(r),o=(i(224),i(65)),l=i.n(o),u=i(34),c=l.a.mark(f),h=l.a.mark(v),d=l.a.mark(g);function f(e,t,i){var n,a;return l.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n=t.subtract(e.position).normalize(),a=n.clone();case 2:if(!(u.k.Dot(n,a)>0)){r.next=11;break}return n.normalize().scaleToRef(e.unitType.maxSpeed,e.velocity),void(r.next=6);case 6:if(!i(e)){r.next=8;break}return r.abrupt("break",11);case 8:t.subtractToRef(e.position,a),r.next=2;break;case 11:e.velocity.scaleInPlace(0);case 12:case"end":return r.stop()}}),c)}function v(e,t){return l.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return e.angularVelocity=Math.PI*(1===e.owner.id?3:-3),i.delegateYield(g(e,t),"t0",2);case 2:e.angularVelocity=0;case 3:case"end":return i.stop()}}),h)}function g(e,t){return l.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!t(e)){i.next=5;break}return void(i.next=3);case 3:i.next=0;break;case 5:case"end":return i.stop()}}),d)}function p(e){return Math.floor(Math.random()*e)}function m(e){if(e.length>0)return e[p(e.length)]}function y(e,t){if(0!==e.length){for(var i=0,n=t(e[0]),a=1;a<e.length;a++){var r=t(e[a]);r<n&&(n=r,i=a)}return e[i]}}function k(e,t){if(0!==e.length){for(var i=e.map(t),n=p(function(e){for(var t=0,i=0;i<e.length;i++)t+=e[i];return t}(i)),a=0;a<i.length;a++)if((n-=i[a])<0)return e[a];return e[e.length-1]}}function b(e,t){var i=e.indexOf(t);i>=0&&e.splice(i,1)}var w,T,S=l.a.mark(C);function U(e){var t=e.tile;return!!t&&(e.inRangeTargets.length>0||!(e.visibleTargets.length>0||e.targetBuilding)&&(t.owner===e.owner.opponent||(!(t.owner!==e.owner||!t.isDamaged()||!e.canRepairTile())||!(t!==e.owner.homeTile||!e.isDamaged()||!e.canRepairSelf()))))}function C(e,t,i){var n,a,r;return l.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:r=function(){if(e.visibleTargets.length>0&&0===e.inRangeTargets.length){var r=y(e.visibleTargets,(function(t){return e.distTo(t)}));if(r)return r.position}return e.targetBuilding?e.targetBuilding.position.clone():!a&&n?t.neighbourClosestTo(e.tile,n).toPos():e.isDamaged()&&e.unitType.repairSelf>0?t.neighbourClosestTo(e.tile,e.owner.homeTile).toPos():(k(t.neighbours(e.tile),i)||e.owner.homeTile).toPos()},n=e.owner.rallyTile,a=!n;case 3:if(!U){s.next=6;break}return s.delegateYield(v(e,U),"t0",6);case 6:return a=a||e.tile===n||!n,s.delegateYield(f(e,r(),U),"t1",8);case 8:s.next=3;break;case 10:case"end":return s.stop()}}),S)}function M(e,t){if(t(e),e.children)for(var i=0;i<e.children.length;i++)M(e.children[i],t)}!function(e){e[e.BasicOffensive=0]="BasicOffensive",e[e.BasicDefensive=1]="BasicDefensive",e[e.Summoned=2]="Summoned"}(w||(w={})),function(e){e[e.Game=0]="Game",e[e.Player=1]="Player",e[e.Board=2]="Board",e[e.Building=3]="Building",e[e.Tile=4]="Tile",e[e.Unit=5]="Unit"}(T||(T={}));var x=l.a.mark(L),P=l.a.mark(z),O=l.a.mark(A),B={id:0,displayName:"Triangle",kind:w.BasicOffensive,range:1,maxHealth:10,maxSpeed:1.5,attackVsUnit:4,attackVsTile:2,repairTile:.5,repairSelf:.5,stealth:5,aiFactory:function(e,t){return L(e,t)}},E={id:1,displayName:"Pentagon",kind:w.BasicDefensive,range:1,maxHealth:15,maxSpeed:2,attackVsUnit:3,attackVsTile:.25,repairTile:2,repairSelf:1,stealth:5,aiFactory:function(e,t){return A(e,t)}},F={id:2,displayName:"Template",kind:w.BasicOffensive,range:1,maxHealth:12,maxSpeed:2,attackVsUnit:3,attackVsTile:1,repairTile:1,repairSelf:.5,stealth:5,aiFactory:function(e,t){return z(e,t)}},j={id:3,displayName:"Charlie",kind:w.Summoned,range:1,maxHealth:40,maxSpeed:.5,attackVsUnit:4,attackVsTile:.25,repairTile:4,repairSelf:2,stealth:1,aiFactory:function(e,t){return A(e,t)}},I={id:4,displayName:"Knight",kind:w.Summoned,range:1,maxHealth:30,maxSpeed:1,attackVsUnit:5,attackVsTile:2,repairTile:1,repairSelf:1,stealth:5,aiFactory:function(e,t){return L(e,t)}},D={id:5,displayName:"Archer",kind:w.Summoned,range:1,maxHealth:25,maxSpeed:2,attackVsUnit:7.5,attackVsTile:.25,repairTile:.5,repairSelf:.5,stealth:10,aiFactory:function(e,t){return L(e,t)}},R={id:6,displayName:"Scout",kind:w.BasicOffensive,range:1,maxHealth:8,maxSpeed:3,attackVsUnit:3,attackVsTile:4,repairTile:.5,repairSelf:.5,stealth:10,aiFactory:function(e,t){return L(e,t)}},V={triangleUT:B,pentagonUT:E,templateUT:F,shielderUT:j,knightUT:I,archerUT:D,scoutUT:R,skirmisherUT:{id:7,displayName:"Skirmisher",kind:w.BasicOffensive,range:.25,maxHealth:12,maxSpeed:2,attackVsUnit:5,attackVsTile:1.5,repairTile:0,repairSelf:0,stealth:5,aiFactory:function(e,t){return L(e,t)}},shielderBasicUT:{id:8,displayName:"Shielder(Basic)",kind:w.BasicDefensive,range:1,maxHealth:25,maxSpeed:1.5,attackVsUnit:1.5,attackVsTile:.25,repairTile:4,repairSelf:1,stealth:2,aiFactory:function(e,t){return A(e,t)}}},_=Object.values(V).sort((function(e,t){return e.id-t.id}));function L(e,t){return l.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.delegateYield(C(e,t,(function(t){var i=t.owner.id,n=i===e.owner.id?1:0===i?2:3;return n*n*n})),"t0",1);case 1:case"end":return i.stop()}}),x)}function z(e,t){return l.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.delegateYield(C(e,t,(function(){return 1})),"t0",1);case 1:case"end":return i.stop()}}),P)}function A(e,t){return l.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.delegateYield(C(e,t,(function(t){var i=t.owner.id===e.owner.id?2:1;return i*i*i})),"t0",1);case 1:case"end":return i.stop()}}),O)}var H=_.map((function(e){return{id:e.id,displayName:e.displayName,imgName:"Triangle"===e.displayName?"off":"def",nextUnitType:function(){return e}}})),N=R,Y=E,G={id:H.length,displayName:"Random",imgName:"rand",nextUnitType:function(){return m([N,Y])}};H.push(G);var W,q={minDurationState:.05,minDurationUI:.2,boardRadius:2,tileSize:2,drawnTileSize:1.96,unitCost:10,buildingCost:50,tileMaxHealth:20,homeTileMaxHealth:50,tileControlThreshold:.8,minUnitsToCapture:2,buildingTimeout:3,speedScale:1,resourcesRate:1,resourceForTile:function(e,t,i,n,a){var r=Math.abs(t)<=1&&Math.abs(n-i)>=2,s=0===n&&1===Math.max(Math.abs(t),Math.abs(i));return e||s?2:r?.5:1},unitTypes:V,unitTypesList:_,unitProductionStrategies:H,upsList:[H[N.id],H[Y.id],G],defaultUPS:function(e){return G},initialUnitType:function(e,t){return t?Y:N}},J=i(48),K=i(51),Z=i(103);!function(e){e[e.active=0]="active",e[e.won=1]="won",e[e.dying=2]="dying"}(W||(W={}));var $,X,Q=2*Math.PI,ee=function(){function e(t,i,n,a,r,s){Object(J.a)(this,e),this.game=t,this.id=i,this.owner=n,this.unitType=a,this.tile=r,this.position=s,this.type=T.Unit,this.name=void 0,this.viewMetaData=void 0,this.state=void 0,this.velocity=void 0,this.angularVelocity=void 0,this.rotY=void 0,this.health=void 0,this.visibleTargets=void 0,this.inRangeTargets=void 0,this.lastTarget=void 0,this.targetBuilding=void 0,this.ai=void 0,this.name="Unit[".concat(i,"]"),this.state=W.active,this.velocity=new u.k,this.angularVelocity=0,this.rotY=0,this.health=this.unitType.maxHealth,this.visibleTargets=[],this.inRangeTargets=[],this.targetBuilding=void 0,this.ai=void 0}return Object(K.a)(e,[{key:"generate",value:function(e){e.generateUnit(this),this.ai=this.unitType.aiFactory(this,this.game.board)}},{key:"updateFrame",value:function(e,t){var i=.3+.01*this.owner.id;switch(this.state){case W.active:this.handlePhysics(t),this.position.y=i;break;case W.won:this.handlePhysics(t);var n=.2*(this.id%3+1)*(.8+Math.sin(this.rotY));this.position.y=i+Math.max(0,n);break;case W.dying:this.position.y-=.05*t,this.position.y<-.25&&this.destroy()}}},{key:"updateLogic",value:function(e,t){this.health<=.001&&this.game.killUnit(this),this.state===W.active&&(this.ai.next(t),this.tile=this.game.board.posToTile(this.position)||this.owner.homeTile,(Math.abs(this.velocity.x)>.01||Math.abs(this.velocity.z)>.01)&&(this.rotY=Math.atan2(this.velocity.x,this.velocity.z)))}},{key:"draw",value:function(e){e.drawUnit(this)}},{key:"healthProportion",value:function(){return this.health/this.unitType.maxHealth}},{key:"incHealth",value:function(e,t){var i=this.health+e*t;this.health=Math.min(this.unitType.maxHealth,Math.max(0,i))}},{key:"harm",value:function(e,t){this.incHealth(-e,t)}},{key:"heal",value:function(e,t){this.incHealth(e,t)}},{key:"offsetTo",value:function(e){return e.position.clone().subtract(this.position)}},{key:"distTo",value:function(e){return this.offsetTo(e).length()}},{key:"inRange",value:function(e){return!(this.unitType.range<.99)||this.distTo(e)<q.tileSize*this.unitType.range*2}},{key:"attackUnits",value:function(e,t){var i=this;this.visibleTargets=e,this.inRangeTargets=this.unitType.range<.99?this.visibleTargets.filter((function(e){return i.inRange(e)})):this.visibleTargets,this.lastTarget&&this.inRangeTargets.includes(this.lastTarget)||(this.lastTarget=k(this.inRangeTargets,(function(e){return 1/e.unitType.stealth}))),this.lastTarget&&this.lastTarget.harm(this.unitType.attackVsUnit,t)}},{key:"attackTile",value:function(e,t){e.harm(this.unitType.attackVsTile,t)}},{key:"repair",value:function(e,t){e.heal(this.unitType.repairTile,t),this.game.canHeal(this,e)&&this.heal(this.unitType.repairSelf,t)}},{key:"isAlive",value:function(){return this.state===W.active||this.state===W.won}},{key:"isDamaged",value:function(){return this.healthProportion()<.99}},{key:"canRepairSelf",value:function(){return this.unitType.repairSelf>.01}},{key:"canRepairTile",value:function(){return this.unitType.repairTile>.01}},{key:"destroy",value:function(){this.game.destroyUnit(this)}},{key:"handlePhysics",value:function(e){this.velocity.scaleAndAddToRef(e*q.speedScale,this.position);var t=this.rotY+this.angularVelocity*e;t>=Q?t-=Q:t<0&&(t+=Q),this.rotY=t}},{key:"setState",value:function(e){if(this.state!==e){switch(e){case W.won:this.velocity.scaleInPlace(0),this.angularVelocity=this.id%4*2-3;break;case W.dying:this.ai=void 0,this.velocity.scaleInPlace(0),this.visibleTargets=[],this.inRangeTargets=[],this.lastTarget=void 0}this.state=e}}}]),e}();!function(e){e[e.None=0]="None",e[e.Summoner=1]="Summoner"}($||($={})),function(e){e[e.Invisible=0]="Invisible",e[e.Ghost=1]="Ghost",e[e.InProgress=2]="InProgress",e[e.Built=3]="Built",e[e.Destroyed=4]="Destroyed"}(X||(X={}));var te=function(){function e(t,i,n){Object(J.a)(this,e),this.id=t,this.game=i,this.tiles=n,this.type=T.Building,this.name=void 0,this.viewMetaData=void 0,this.owner=void 0,this.buildingType=void 0,this.state=void 0,this.position=void 0,this.builtProportion=void 0,this.timeTillActivate=void 0,this.activatedUnits=void 0,this.sacrificedUnitCount=void 0,this.name="building[".concat(t,"]"),this.owner=i.gaia,this.buildingType=$.None,this.state=X.Invisible,this.position=function(e){for(var t=new u.k,i=0;i<e.length;i++)t.addInPlace(e[i]);return t.scaleInPlace(1/e.length),t}(n.map((function(e){return e.toPos()})));for(var a=0;a<n.length;a++)n[a].adjBuildings.push(this);this.builtProportion=0,this.timeTillActivate=q.buildingTimeout,this.activatedUnits=[],this.sacrificedUnitCount=0}return Object(K.a)(e,[{key:"generate",value:function(e){e.generateBuilding(this)}},{key:"updateLogic",value:function(e,t){this.state===X.Built&&(0===this.activatedUnits.length?this.chargeBuilding(t):this.awaitActivatedUnits())}},{key:"draw",value:function(e){e.drawBuilding(this)}},{key:"startBuilding",value:function(e,t){this.owner=t,this.state=X.InProgress,this.builtProportion=0}},{key:"continueBuilding",value:function(e){var t=q.buildingCost*(1-this.builtProportion),i=Math.min(t,e);return this.builtProportion+=i/q.buildingCost,this.builtProportion>.99&&this.finishBuilding(),e-i}},{key:"finishBuilding",value:function(){this.state=X.Built,this.timeTillActivate=q.buildingTimeout}},{key:"destroyBuilding",value:function(){if(this.owner!==this.game.gaia){this.owner=this.game.gaia,this.state=X.Destroyed,this.timeTillActivate=q.buildingTimeout;for(var e=0;e<this.activatedUnits.length;e++)this.activatedUnits[e].targetBuilding=void 0;this.activatedUnits=[],this.builtProportion=0}}},{key:"chargeBuilding",value:function(e){this.timeTillActivate-=e,this.timeTillActivate<=0&&(this.timeTillActivate=0,this.activate()&&(this.timeTillActivate=q.buildingTimeout))}},{key:"canSacrifice",value:function(e){var t=e.position.clone().subtractInPlace(this.position);return t.y=0,t.length()<.1}},{key:"sacrificeUnit",value:function(e){this.sacrificedUnitCount++,this.game.destroyUnit(e)}},{key:"summonUnit",value:function(){var e=m(this.tiles);this.game.spawnUnit(this.owner,q.unitTypes.knightUT,e,this.position.clone())}},{key:"awaitActivatedUnits",value:function(){for(var e=!1,t=0;t<this.activatedUnits.length;t++){var i=this.activatedUnits[t];i.state===W.active&&this.canSacrifice(i)&&(this.sacrificeUnit(i),e=!0)}e&&(2===this.sacrificedUnitCount?(this.summonUnit(),this.sacrificedUnitCount=0,this.activatedUnits=[]):this.activatedUnits=this.activatedUnits.filter((function(e){return e.state===W.active})))}},{key:"activate",value:function(){if(this.owner===this.game.gaia)return!1;for(var e=[],t=[],i=0;i<this.tiles.length;i++){if(this.tiles[i].occupancy[this.owner.opponent.id]>0)return!1;var n=this.tiles[i].unitsOnTile;e.push.apply(e,Object(Z.a)(n.filter((function(e){return e.unitType.kind===w.BasicOffensive&&void 0===e.targetBuilding})))),t.push.apply(t,Object(Z.a)(n.filter((function(e){return e.unitType.kind===w.BasicDefensive&&void 0===e.targetBuilding}))))}if(0===e.length||0===t.length)return!1;var a=m(e),r=m(t);return this.activatedUnits=[a,r],this.sacrificedUnitCount=0,a.targetBuilding=this,r.targetBuilding=this,!0}},{key:"updateState",value:function(){if(this.owner===this.game.gaia){for(var e=0;e<this.tiles.length;e++)if(this.tiles[e].owner!==this.game.builder||this.tiles[e].isDamaged())return void(this.state===X.Ghost&&(this.state=X.Invisible));this.state=X.Ghost}else for(var t=0;t<this.tiles.length;t++)if(this.tiles[t].owner!==this.owner)return void this.destroyBuilding()}}]),e}(),ie=i(75),ne=function(){function e(t,i,n,a,r,s){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0;Object(J.a)(this,e),this.game=t,this.owner=i,this.isHome=n,this.resourceAmount=a,this.type=T.Tile,this.name=void 0,this.viewMetaData=void 0,this.coords=void 0,this.health=void 0,this.maxHealth=void 0,this.occupancy=void 0,this.unitsOnTile=void 0,this.adjBuildings=void 0,void 0===o?o=-(r+s):r+s+o!==0&&console.error("Attempting to create an invalid Tile",{q:r,r:s,s:o}),this.name="Tile[".concat(r,",").concat(s,",").concat(o,"]"),this.coords=new u.k(r,s,o),this.maxHealth=n?q.homeTileMaxHealth:q.tileMaxHealth,this.health=n?this.maxHealth:0,this.occupancy=[0,0,0],this.adjBuildings=[],this.unitsOnTile=[]}return Object(K.a)(e,[{key:"generate",value:function(e){e.generateTile(this)}},{key:"updateLogic",value:function(e,t){var i=q.resourcesRate,n=q.tileControlThreshold;this.resolveUnits(this.game.aliveUnits,t),this.healthProportion()>n&&(this.owner.resourceCount+=t*i*this.resourceAmount)}},{key:"draw",value:function(e){e.drawTile(this)}},{key:"equals",value:function(e){return this.coords.equals(e.coords)}},{key:"healthProportion",value:function(){return Math.min(1,Math.max(0,this.health/this.maxHealth))}},{key:"isDamaged",value:function(){return this.healthProportion()<.99}},{key:"updateBuildings",value:function(){for(var e=0;e<this.adjBuildings.length;e++)this.adjBuildings[e].updateState()}},{key:"incHealth",value:function(e,t){var i=this.health+e*t;this.health=Math.min(this.maxHealth,Math.max(0,i)),this.isDamaged()||this.updateBuildings()}},{key:"harm",value:function(e,t){this.incHealth(-e,t)}},{key:"heal",value:function(e,t){this.incHealth(e,t)}},{key:"canCapture",value:function(e){return this.owner===this.game.gaia&&e.filter((function(e){return e.canRepairTile()})).length>=q.minUnitsToCapture}},{key:"resolveUnits",value:function(e,t){var i=this;if(this.unitsOnTile=e.filter((function(e){return e.tile===i})),0!==this.unitsOnTile.length){var n=Object(ie.a)(this.game.players,3),a=n[0],r=n[1],s=n[2],o=this.unitsOnTile.filter((function(e){return e.owner===r})),l=this.unitsOnTile.filter((function(e){return e.owner===s}));if(this.occupancy=[0,o.length,l.length],o.forEach((function(e){return e.attackUnits(l,t)})),l.forEach((function(e){return e.attackUnits(o,t)})),o.length>0&&l.length>0);else{var u=this.unitsOnTile[0].owner;this.canCapture(this.unitsOnTile)&&this.capture(u),this.owner===u?this.unitsOnTile.forEach((function(e){return e.repair(i,t)})):this.owner!==a&&(this.unitsOnTile.forEach((function(e){return e.attackTile(i,t)})),this.healthProportion()<.1&&this.capture(a))}}}},{key:"capture",value:function(e){this.owner=e,this.updateBuildings()}},{key:"toPosOffset",value:function(e,t){var i=this.coords,n=i.x,a=i.y,r=n+e.x*t,s=a+e.y*t;return new u.k(1.5*r*q.tileSize,0,ae*(.5*r+s)*q.tileSize)}},{key:"toPos",value:function(){return this.toPosOffset(u.k.Zero(),0)}}],[{key:"distBetween",value:function(e,t){var i=e.coords.subtract(t.coords),n=i.x,a=i.y,r=i.z;return.5*(Math.abs(n)+Math.abs(a)+Math.abs(r))}},{key:"roundCoords",value:function(e,t){var i=-e-t,n=Math.round(e),a=Math.round(t),r=Math.round(i),s=Math.abs(e-n),o=Math.abs(t-a),l=Math.abs(i-r);return s>Math.max(o,l)?{q:-a-r,r:a}:o>l?{q:n,r:-n-r}:{q:n,r:a}}}]),e}();ne.direction={NN:new u.k(0,1,-1),NE:new u.k(1,0,-1),SE:new u.k(1,-1,0),SS:new u.k(0,-1,1),SW:new u.k(-1,0,1),NW:new u.k(-1,1,0)},ne.directions=[ne.direction.NN,ne.direction.NE,ne.direction.SE,ne.direction.SS,ne.direction.SW,ne.direction.NW];var ae=Math.sqrt(3),re=function(){function e(t,i,n){var a=this;Object(J.a)(this,e),this.game=t,this.radius=i,this.type=T.Board,this.name="Board",this.children=void 0,this.tiles=void 0,this.tileList=void 0,this.buildingList=void 0,this.tiles=[],this.tileList=[],this.buildingList=[],this.children=[];for(var r=i,s=-r;s<=r;s++){this.tiles[s+r]=[];for(var o=-r;o<=r;o++){var l=-(s+o);if(-r<=l&&l<=r&&n(s,o,l)){var u=0===s&&Math.abs(o)===r,c=t.players[u?o===r?1:2:0],h=q.resourceForTile(u,s,o,l,r),d=new ne(t,c,u,h,s,o);this.tiles[s+r][o+r]=d,this.tileList.push(d),this.children.push(d)}}}for(var f=function(e,i,n){var r=a.neighbour(e,i),s=a.neighbour(e,n);if(r&&s){var o=new te(a.buildingList.length,t,[e,r,s]);a.buildingList.push(o),a.children.push(o)}},v=0;v<this.tileList.length;v++){var g=this.tileList[v];f(g,ne.direction.SW,ne.direction.SS),f(g,ne.direction.SS,ne.direction.SE)}}return Object(K.a)(e,[{key:"tile",value:function(e,t){var i=this.radius;if(-i<=e&&e<=i&&-i<=t&&t<=i)return this.tiles[e+i][t+i]}},{key:"neighbours",value:function(e){var t=this;return ne.directions.map((function(i){return t.neighbour(e,i)})).filter((function(e){return!!e}))}},{key:"neighbourClosestTo",value:function(e,t){var i=this.neighbours(e);if(0===i.length)return t;for(var n=i.map((function(e){return ne.distBetween(e,t)})),a=0,r=1;r<i.length;r++)n[r]<n[a]&&(a=r);return i[a]}},{key:"neighbour",value:function(e,t){return this.tile(e.coords.x+t.x,e.coords.y+t.y)}},{key:"posToTile",value:function(e){var t=e.x/q.tileSize,i=e.z/q.tileSize,n=ne.roundCoords(2/3*t,(se*i-t)/3),a=n.q,r=n.r;return this.tile(a,r)}}]),e}(),se=Math.sqrt(3),oe=function(){function e(t,i,n,a,r){Object(J.a)(this,e),this.game=t,this.id=i,this.name=n,this.hue=a,this.maxSaturation=r,this.type=T.Player,this.viewMetaData=void 0,this.stdTileColor=void 0,this.homeTileColor=void 0,this.fullUnitColor=void 0,this.deadUnitColor=void 0,this.opponent=void 0,this.homeTile=void 0,this.rallyTile=void 0,this.resourceCount=void 0,this.ups=void 0,this.activeBuildings=void 0,this.stdTileColor=e.color(a,.4*r,.8),this.homeTileColor=e.color(a,.8*r,.6),this.fullUnitColor=e.color(a,.95*r,.95),this.deadUnitColor=e.color(a,.4*r,.3,.3),this.resourceCount=0,this.ups=q.defaultUPS(this.id),this.activeBuildings=[],this.homeTile=void 0,this.rallyTile=void 0,this.opponent=void 0}return Object(K.a)(e,[{key:"generate",value:function(e){var t=this;this.homeTile=this.game.board.tileList.find((function(e){return e.owner===t&&e.isHome})),this.opponent=this.game.players.find((function(e){return e.id>0&&e.id!==t.id})),e.generatePlayer(this)}},{key:"updateLogic",value:function(e,t){if(!(this.resourceCount<.99)){for(var i=0;i<this.activeBuildings.length;i++)this.resourceCount=this.activeBuildings[i].continueBuilding(this.resourceCount);for(this.activeBuildings=this.activeBuildings.filter((function(e){return e.builtProportion<.99}));this.resourceCount>=q.unitCost;)this.resourceCount-=q.unitCost,this.game.spawnUnit(this,this.ups.nextUnitType(),this.homeTile)}}},{key:"draw",value:function(e){e.drawPlayer(this)}},{key:"isAlive",value:function(){return this.homeTile.owner===this}},{key:"tileColor",value:function(t,i,n){var a=(t?.8:.4)*i*this.maxSaturation,r=(t?.6:.8)+(n?.1:0);return e.color(this.hue,a,r)}}],[{key:"color",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=new u.b;u.b.HSVtoRGBToRef(e,t,i,a);var r=a.r,s=a.g,o=a.b;return new u.c(r,s,o,n)}}]),e}(),le=function(){function e(){Object(J.a)(this,e),this.type=T.Game,this.name="Game",this.children=void 0,this.view=void 0,this.players=void 0,this.gaia=void 0,this.board=void 0,this.aliveUnits=void 0,this.winner=void 0,this.builder=void 0,this.gaia=new oe(this,0,"Gaia",180,.01);var t=new oe(this,1,"Green",120,1),i=new oe(this,2,"Red",0,1);this.players=[this.gaia,t,i],this.board=new re(this,q.boardRadius,(function(){return!0})),this.aliveUnits=[],this.winner=void 0,this.children=[this.board,t,i]}return Object(K.a)(e,[{key:"generate",value:function(e){this.view=e}},{key:"updateLogic",value:function(e,t){}},{key:"startGame",value:function(){var e=this,t=Object(ie.a)(this.players,3),i=t[1],n=t[2],a=this.board.neighbours(i.homeTile),r=this.board.neighbours(n.homeTile),s=function(t,i){e.spawnUnit(t,q.initialUnitType(t.id,i.isHome),i)};s(n,n.homeTile),s(i,i.homeTile),s(i,a[1]),s(n,r[0])}},{key:"spawnUnit",value:function(e,t,i,n){var a=this.children.length,r=new ee(this,a,e,t,i,n||i.toPos());this.view&&r.generate(this.view),this.children.push(r),this.aliveUnits.push(r)}},{key:"killUnit",value:function(e){e.setState(W.dying),b(this.aliveUnits,e)}},{key:"destroyUnit",value:function(e){var t;this.killUnit(e),b(this.children,e),null===(t=this.view)||void 0===t||t.destroyUnit(e)}},{key:"running",value:function(){if(!this.winner){var e=Object(ie.a)(this.players,3),t=e[1],i=e[2];t.isAlive()?i.isAlive()||this.finishGame(t):this.finishGame(i)}return void 0===this.winner}},{key:"finishGame",value:function(e){this.winner=e;for(var t=0;t<this.children.length;t++){var i=this.children[t];if(i.type===T.Unit){var n=i;n.owner===e?n.isAlive()&&n.setState(W.won):this.killUnit(n)}}}},{key:"canHeal",value:function(e,t){return t.isHome&&e.owner===t.owner&&t.healthProportion()>q.tileControlThreshold}},{key:"allowSelect",value:function(e){return e.type===T.Tile||e.type===T.Building}},{key:"toggleRallyTile",value:function(e,t){e.rallyTile=e.rallyTile===t?void 0:t}},{key:"selectBuilding",value:function(e){this.builder&&e.owner===this.gaia&&e.state===X.Ghost&&(e.startBuilding($.Summoner,this.builder),this.builder.activeBuildings.push(e),this.updateBuilder(void 0))}},{key:"select",value:function(e,t){t.type===T.Tile?this.toggleRallyTile(e,t):t.type===T.Building&&this.selectBuilding(t)}},{key:"updateBuilder",value:function(e){this.builder=e;for(var t=0;t<this.board.buildingList.length;t++)this.board.buildingList[t].updateState()}}]),e}(),ue=i(214),ce=i(101),he=i(218),de=(i(226),{marginTop:"0.5em",marginLeft:"0.25em",marginRight:"0.25em",width:"8em",height:"8em",backgroundSize:"contain",outline:"none",boxShadow:"none",border:0}),fe=function(e){var t=e.text,i=e.active,n=e.alwaysClickable,r=e.onClick,s=e.style,o=Object(ce.a)({},de,{},s,{backgroundColor:i?"white":"transparent",transition:n?void 0:i?"background-color 0.5s":"background-color 5s cubic-bezier(.01,.80,.65,.93) 0s"}),l="option-button-"+(n?"always-clickable":i?"active":"clickable");return a.a.createElement(he.a.button,{style:o,onClick:r,className:l},t)},ve={zIndex:100,color:"whitesmoke",margin:"auto",fontSize:"1em"},ge=function(e){var t=e.view,i=e.style,r=e.getMessage,s=Object(n.useState)(""),o=Object(ie.a)(s,2),l=o[0],u=o[1];Object(n.useEffect)(t.useListenerEffect((function(){return u(r(t))})),[t,u,r]);var c=i?Object(ce.a)({},ve,{},i):ve;return a.a.createElement("div",{style:c},l)},pe={position:"absolute",zIndex:99,padding:"10px",bottom:0,margin:"auto"},me=function(e){var t=e.view,i=e.playerIndex,r=e.style,s=Object(n.useCallback)((function(){return t.getPlayerStatus(i)}),[t,i]),o=Object(n.useState)(void 0),l=Object(ie.a)(o,2),u=l[0],c=l[1];Object(n.useEffect)(t.useListenerEffect((function(){return c(t.getPlayerUPS(i))})),[t,c,i]);var h=Object(n.useState)(!1),d=Object(ie.a)(h,2),f=d[0],v=d[1];Object(n.useEffect)(t.useListenerEffect((function(){return v(t.getIsBuilder(i))})),[t,v,i]);var g=r?Object(ce.a)({},pe,{},r):pe;return a.a.createElement("div",{style:g},a.a.createElement(ge,{view:t,getMessage:s}),q.upsList.map((function(e){return a.a.createElement(fe,{key:e.id,text:"",active:e===u,alwaysClickable:!1,style:{backgroundImage:'url("/z-minus/img/'.concat(e.imgName,"-").concat(i,'.png")')},onClick:function(){return t.setPlayerUPS(i,e)}})})),a.a.createElement(fe,{key:"buildingToggle",text:"",active:f,alwaysClickable:!0,style:{backgroundImage:'url("/z-minus/img/rand-'.concat(i,'.png")')},onClick:function(){return t.setIsBuilder(i,!f)}}))},ye=(i(212),i(215)),ke=i.n(ye),be=i(216),we=i.n(be),Te=function(){function e(t,i,n){Object(J.a)(this,e),this.instances=t,this.globalScale=i,this.globalRotY=n}return Object(K.a)(e,[{key:"setColour",value:function(e){for(var t=0;t<this.instances.length;t++)this.instances[t].z_is_colorable&&(this.instances[t].instancedBuffers.color=e)}},{key:"setScale",value:function(e){for(var t=0;t<this.instances.length;t++)this.instances[t].z_is_root&&this.instances[t].scaling.setAll(e*this.globalScale)}},{key:"setPosition",value:function(e){for(var t=0;t<this.instances.length;t++)this.instances[t].z_is_root&&this.instances[t].position.copyFrom(e)}},{key:"setRotationY",value:function(e){for(var t=0;t<this.instances.length;t++)this.instances[t].rotation.y=this.globalRotY+e}},{key:"setVisible",value:function(e){for(var t=0;t<this.instances.length;t++)this.instances[t].z_is_root&&(this.instances[t].isVisible=e)}},{key:"setPickable",value:function(e){for(var t=0;t<this.instances.length;t++)this.instances[t].z_is_root&&(this.instances[t].isPickable=e)}},{key:"setMetaData",value:function(e){for(var t=0;t<this.instances.length;t++)this.instances[t].metadata=e}}],[{key:"toDrawnAtom",value:function(e,t,i){var n=e;return n.z_is_root=!e.parent,n.z_index=t,n.z_is_colorable=i,n}},{key:"fromSingle",value:function(t){return new e([this.toDrawnAtom(t,0,!0)],1,0)}}]),e}(),Se=function(){function e(t){Object(J.a)(this,e),this.factory=t,this.prototype=void 0,this.prototype=void 0}return Object(K.a)(e,[{key:"getMeshInstance",value:function(e,t,i){this.prototype||(this.prototype=this.factory(e),this.prototype.isVisible=!1,this.prototype.isPickable=!1);var n=this.prototype.createInstance(t);return n.position.copyFrom(i||this.prototype.position),n.isVisible=!0,n.isPickable=!0,Te.fromSingle(n)}}]),e}(),Ue=function(){function e(t,i,n,a,r){Object(J.a)(this,e),this.fileName=t,this.scale=i,this.rotY=n,this.colorAll=a,this.scene=r,this.prototypes=void 0,this.prototypes=void 0}return Object(K.a)(e,[{key:"process",value:function(e){this.prototypes=e;for(var t=0;t<this.prototypes.length;t++){var i=this.prototypes[t];i.scaling.setAll(this.scale),(this.colorAll||i.material&&("Player Primary"===i.material.name||"Primary Colour"===i.material.name))&&i.geometry&&i.geometry.getTotalVertices()>0&&(i.registerInstancedBuffer("color",4),i.instancedBuffers.color=new u.c(1,1,1,1),i.useVertexColors=!0,i.z_color=!0),i.z_loaded_index=t,i.isVisible=!1,i.isPickable=!1}return this.prototypes}},{key:"load",value:function(){var e=this;return u.i.ImportMeshAsync("","/z-minus/assets/",this.fileName,this.scene).then((function(t){var i=t.meshes;return e.process(i)}))}},{key:"getMeshInstance",value:function(e,t){var i=this;ke()(!!this.prototypes,"attempting to call getMeshInstance before models loaded");for(var n=this.prototypes.map((function(t,n){return Te.toDrawnAtom(t.geometry&&t.geometry.getTotalVertices()>0?t.createInstance("".concat(e,"[").concat(n,"]")):new u.f("".concat(e,"[").concat(n,"]"),i.scene),n,t.z_color)})),a=0;a<n.length;a++){n[a].z_is_colorable&&(n[a].instancedBuffers.color=new u.c(1,1,1,1)),n[a].isVisible=!0,n[a].isPickable=!0;var r=this.prototypes[a].parent;r&&(n[a].parent=n[r.z_loaded_index])}return t&&n[0].position.copyFrom(t),new Te(n,this.scale,this.rotY)}}]),e}(),Ce=function(){function e(t){Object(J.a)(this,e),this.factory=t,this.prototype=void 0,this.prototype={}}return Object(K.a)(e,[{key:"getMeshInstance",value:function(e,t,i,n,a){if(!this.prototype[t]){var r=this.factory(e,i);r.isVisible=!1,r.isPickable=!1,this.prototype[t]=r}var s=this.prototype[t],o=s.createInstance(n);return o.position.copyFrom(a||s.position),o.isVisible=!0,o.isPickable=!0,Te.fromSingle(o)}}]),e}();function Me(e){var t={radius:q.drawnTileSize,tessellation:6,sideOrientation:u.f.DOUBLESIDE},i=u.g.CreateDisc("tileMesh",t,e);i.rotation.x=.5*Math.PI;var n=new u.j("tileMeshMaterial",e);return n.specularColor=new u.b(.5,.6,.87),i.material=n,i.receiveShadows=!0,i.registerInstancedBuffer("color",4),i.instancedBuffers.color=new u.c(1,1,1,1),i}function xe(e){var t={width:.07*q.drawnTileSize,depth:.05,height:.07*q.drawnTileSize},i=u.g.CreateBox("resourceMesh",t,e);i.rotation.x=.5*Math.PI;var n=new u.j("resMeshMaterial",e);return n.specularColor=new u.b(.5,.6,.87),n.diffuseColor=new u.b(1,.9,0),i.material=n,i.receiveShadows=!1,i}function Pe(e,t){var i=[new u.k(.02,0,0),new u.k(.02,0,1)],n=[t.fullUnitColor,t.fullUnitColor];return u.g.CreateLines("targetIndMesh",{points:i,colors:n,useVertexAlpha:!1},e)}function Oe(e){var t=.05,i=.75*q.drawnTileSize,n=.55*i,a=i-n,r=[new u.k(-t,0,0),new u.k(t,0,0),new u.k(t,0,n),new u.k(a,0,n),new u.k(a,0,i),new u.k(t,0,i),new u.k(-t,0,i)],s=u.g.ExtrudePolygon("rallyFlagMesh",{shape:r,depth:.1},e,we.a);s.rotation.x=-.5*Math.PI;var o=new u.j("rallyFlagMaterial",e);return o.specularColor=new u.b(.5,.6,.87),s.material=o,s.receiveShadows=!1,s.registerInstancedBuffer("color",4),s.instancedBuffers.color=new u.c(1,1,1,1),s}var Be=function(){function e(t){Object(J.a)(this,e),this.scene=t,this.tileFactory=void 0,this.resourceFactory=void 0,this.targetIndFactory=void 0,this.rallyFlagFactory=void 0,this.spireFactory=void 0,this.knightFactory=void 0,this.pentagonFactory=void 0,this.scoutFactory=void 0,this.shielderFactory=void 0,this.skirmisherFactory=void 0,this.triangleFactory=void 0,this.tileFactory=new Se(Me),this.resourceFactory=new Se(xe),this.targetIndFactory=new Ce(Pe),this.rallyFlagFactory=new Se(Oe),this.spireFactory=new Ue("spire.gltf",.2,0,!0,t),this.knightFactory=new Ue("knight.glb",.15,0,!1,t),this.pentagonFactory=new Ue("pentagon.glb",.15,0,!1,t),this.scoutFactory=new Ue("scout.glb",.15,0,!1,t),this.shielderFactory=new Ue("shielder.glb",.25,0,!1,t),this.skirmisherFactory=new Ue("skirmisher.glb",.25,0,!1,t),this.triangleFactory=new Ue("triangle.glb",.25,0,!0,t)}return Object(K.a)(e,[{key:"loadAll",value:function(){var e=this;return this.spireFactory.load().then((function(){return e.knightFactory.load()})).then((function(){return e.pentagonFactory.load()})).then((function(){return e.scoutFactory.load()})).then((function(){return e.shielderFactory.load()})).then((function(){return e.skirmisherFactory.load()})).then((function(){return e.triangleFactory.load()})).then((function(){return e}))}},{key:"makeTileMesh",value:function(e){return this.tileFactory.getMeshInstance(this.scene,e.name,e.toPos())}},{key:"makeResourceMesh",value:function(e,t){var i=e.toPosOffset(ne.directions[t],.3),n=this.resourceFactory.getMeshInstance(this.scene,"".concat(e.name,"[").concat(t,"]"),i);return n.setRotationY(t*Math.PI/6),n}},{key:"makeRallyFlagMesh",value:function(e){var t="".concat(e.name,"/rally"),i=this.rallyFlagFactory.getMeshInstance(this.scene,t);return i.setPickable(!1),i}},{key:"meshFactoryFor",value:function(e){var t=q.unitTypes;switch(e.id){case t.triangleUT.id:return this.triangleFactory;case t.pentagonUT.id:return this.pentagonFactory;case t.templateUT.id:return this.triangleFactory;case t.shielderUT.id:return this.shielderFactory;case t.knightUT.id:case t.archerUT.id:return this.knightFactory;case t.scoutUT.id:return this.scoutFactory;case t.skirmisherUT.id:return this.skirmisherFactory;case t.shielderBasicUT.id:return this.shielderFactory}throw new Error("Unsupported Unit Type ".concat(e.displayName," (").concat(e.id,")"))}},{key:"makeUnitMesh",value:function(e){var t=e.name,i=e.position,n=e.unitType,a=e.owner,r=this.meshFactoryFor(n).getMeshInstance(t,i);return r.setColour(a.fullUnitColor),r}},{key:"makeTargetIndMesh",value:function(e){var t=e.owner,i=e.name,n=e.position;return this.targetIndFactory.getMeshInstance(this.scene,t.id,t,i+"/ind",n)}},{key:"makeBuildingMesh",value:function(e){var t=e.name,i=e.position.clone();return i.y=-.8,this.spireFactory.getMeshInstance(t,i)}}]),e}(),Ee=function(){function e(t){Object(J.a)(this,e),this.game=t,this.generated=void 0,this.scene=void 0,this.meshCache=void 0,this.listeners=void 0,this.elapsedSinceState=0,this.elapsedSinceUI=0,this.hovering=null,this.buildingColorGhost=new u.c(1,1,1,1),this.listeners=[],this.scene=void 0,this.meshCache=void 0,this.generated=!1}return Object(K.a)(e,[{key:"generate",value:function(e){var t=this;if(!this.generated){e.useRightHandedSystem=!0,this.scene=e,this.meshCache=new Be(this.scene),this.scene.ambientColor=new u.b(1,1,1);var i=new u.a("camera1",0,0,10,new u.k(0,6,16),this.scene);i.lowerBetaLimit=.1,i.upperBetaLimit=Math.PI/2*.8,i.lowerRadiusLimit=10,i.upperRadiusLimit=100,i.setTarget(u.k.Zero());var n=this.scene.getEngine().getRenderingCanvas();i.attachControl(n,!0);for(var a=[new u.e("light",new u.k(0,1,-2),this.scene),new u.e("light",new u.k(1,1,1),this.scene),new u.e("light",new u.k(-1,1,1),this.scene)],r=0;r<a.length;r++)a[r].intensity=.4;this.scene.onPointerPick=function(e,i){var n=i.pickedMesh;if(n&&n.metadata){var a=0===e.button?1:2,r=t.game.players[a];t.game.select(r,n.metadata)}},this.meshCache.loadAll().then((function(){M(t.game,(function(e){return e.generate&&e.generate(t)})),t.game.startGame(),t.generated=!0}))}}},{key:"ifElapsed",value:function(e,t,i,n){var a=e+t;return a>i?(n.call(this,a),0):a}},{key:"render",value:function(){var e=this;if(this.generated){var t=this.scene.pick(this.scene.pointerX,this.scene.pointerY),i=t&&t.hit&&t.pickedMesh&&t.pickedMesh.metadata;i&&!this.game.allowSelect(i)&&(i=this.hovering),this.hovering=i;var n=this.scene.getEngine().getDeltaTime(),a=Math.min(50,n)/1e3;this.elapsedSinceState=this.ifElapsed(this.elapsedSinceState,a,q.minDurationState,this.updateState),this.elapsedSinceUI=this.ifElapsed(this.elapsedSinceUI,a,q.minDurationUI,this.updateUI),M(this.game,(function(t){t.updateFrame&&t.updateFrame(e,a),t.draw&&t.draw(e)}))}}},{key:"updateState",value:function(e){var t=this;this.game.running()&&M(this.game,(function(i){return i.updateLogic&&i.updateLogic(t,e)}))}},{key:"updateUI",value:function(e){for(var t=0;t<this.listeners.length;t++)this.listeners[t]()}},{key:"addListener",value:function(e){this.listeners.push(e)}},{key:"removeListener",value:function(e){this.listeners=this.listeners.filter((function(t){return t!==e}))}},{key:"useListenerEffect",value:function(e){var t=this;return function(){return t.addListener(e),function(){return t.removeListener(e)}}}},{key:"generateUnit",value:function(e){var t=this.meshCache.makeUnitMesh(e),i=this.meshCache.makeTargetIndMesh(e);e.viewMetaData={mesh:t,targetInd:i},t.setMetaData(e)}},{key:"destroyUnit",value:function(e){var t=e.viewMetaData.mesh,i=e.viewMetaData.targetInd;t.setVisible(!1),i.setVisible(!1)}},{key:"drawUnit",value:function(e){var t=e.viewMetaData.mesh,i=e.viewMetaData.targetInd;if(e.isAlive()||t.setColour(e.owner.deadUnitColor),t.setScale(.5+.5*e.healthProportion()),t.setPosition(e.position),t.setRotationY(e.rotY),e.lastTarget){i.setVisible(!0),i.setPosition(e.position);var n=e.offsetTo(e.lastTarget);i.setScale(n.length()),i.setRotationY(Math.atan2(n.x,n.z))}else i.setVisible(!1)}},{key:"generateTile",value:function(e){var t=this.meshCache.makeTileMesh(e);e.viewMetaData=t,t.setMetaData(e);for(var i=e.resourceAmount,n=i<.75?3:2,a=Math.abs(e.coords.x)%n,r=0;r<ne.directions.length;r++)(i>1.5||i<.75&&r%3===a||i>=.75&&r%2===a)&&this.meshCache.makeResourceMesh(e,r)}},{key:"drawTile",value:function(e){e.viewMetaData.setColour(e.owner.tileColor(e.isHome,e.healthProportion(),this.hovering===e))}},{key:"generateBuilding",value:function(e){var t=this.meshCache.makeBuildingMesh(e);t.setMetaData(e),e.viewMetaData=t}},{key:"drawBuilding",value:function(e){var t=e.viewMetaData;switch(e.state){case X.Invisible:case X.Destroyed:t.setVisible(!1);break;case X.Ghost:t.setVisible(!0),t.setColour(this.hovering===e?this.game.builder.fullUnitColor:this.buildingColorGhost);break;case X.InProgress:t.setVisible(!0),t.setColour(e.owner.tileColor(!0,e.builtProportion,!1));break;case X.Built:t.setVisible(!0),t.setColour(e.owner.fullUnitColor),t.setRotationY(2*Math.PI*e.timeTillActivate/q.buildingTimeout);break;default:throw new Error("Unknown Building State ".concat(e.state," for ").concat(e.name))}}},{key:"generatePlayer",value:function(e){var t=this.meshCache.makeRallyFlagMesh(e);t.setColour(e.homeTileColor),e.viewMetaData=t,t.setMetaData(e)}},{key:"drawPlayer",value:function(e){var t=e.viewMetaData;if(t.setVisible(!!e.rallyTile),e.rallyTile){var i=e.rallyTile.toPos().clone();if(e.rallyTile===e.opponent.rallyTile){var n=1===e.id?1:-1;i.x+=.15*q.drawnTileSize*n,i.z+=.25*q.drawnTileSize*n}t.setPosition(i)}}},{key:"gameWinnerMessage",value:function(){return this.game.winner?"".concat(this.game.winner.name," wins!"):""}},{key:"getFPS",value:function(){return Math.round(this.scene.getEngine().getFps())}},{key:"getPlayerStatus",value:function(e){var t,i,n=this.game.players[e],a=Math.floor(n.resourceCount),r=this.game.board.tileList.filter((function(e){return e.owner===n&&!e.isDamaged()})),s=r.length,o=r.reduce((function(e,t){return e+t.resourceAmount}),0),l=(t=this.game.aliveUnits,i=function(e){return e.owner===n},t.filter(i).length);return"".concat(n.name,": $").concat(a,", ").concat(s," tile(s), ").concat(l," unit(s), +$").concat(o,"/s")}},{key:"getPlayerUPS",value:function(e){return this.game.players[e].ups}},{key:"setPlayerUPS",value:function(e,t){this.game.players[e].ups=t,this.updateUI(0)}},{key:"getIsBuilder",value:function(e){return this.game.builder===this.game.players[e]}},{key:"setIsBuilder",value:function(e,t){this.game.updateBuilder(t?this.game.players[e]:void 0)}}]),e}();function Fe(e){return"FPS: ".concat(e.getFPS())}var je={position:"absolute",top:0,right:0,opacity:.8,padding:"0.5em"};function Ie(e){return e.gameWinnerMessage()}var De,Re={position:"absolute",top:"25vh",left:0,right:0,fontSize:"6em",textAlign:"center",textShadow:"#111 3px 3px"},Ve={left:0,textAlign:"left",borderRight:"1px dashed forestgreen",borderTop:"1px dashed forestgreen"},_e={right:0,textAlign:"right",borderLeft:"1px dashed red",borderTop:"1px dashed red"},Le=function(e){var t=e.game,i=Object(n.useMemo)((function(){return new Ee(t)}),[t]);return a.a.createElement(a.a.Fragment,null,a.a.createElement(ge,{view:i,style:Re,getMessage:Ie}),a.a.createElement(ge,{view:i,style:je,getMessage:Fe}),a.a.createElement(ue.a,{antialias:!0,onSceneReady:function(e){return i.generate(e)},onRender:function(){return i.render()},id:"game-canvas"}),a.a.createElement(me,{view:i,playerIndex:1,style:Ve}),a.a.createElement(me,{view:i,playerIndex:2,style:_e}))},ze=(i(231),new le),Ae=function(){return a.a.createElement("div",{className:"fullscreen"},a.a.createElement(Le,{game:ze}))},He=i(102),Ne=(i(232),i(217)),Ye=i.n(Ne),Ge=function(){function e(t,i){Object(J.a)(this,e);var n=(this.workerFactory=t)();for(var a in this.poolSize=i||4,this.used=1,this.pool=[n],this.jobs=[],n)n.hasOwnProperty(a)&&"function"===typeof n[a]&&(this[a]=this._method(a))}return Object(K.a)(e,[{key:"_method",value:function(e){var t=this;return function(){for(var i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return t._queueJob(e,n)}}},{key:"_queueJob",value:function(e,t){var i=this;return new Promise((function(n,a){i.jobs.push({method:e,args:t,y:n,n:a}),i._nextJob()}))}},{key:"_nextJob",value:function(){var e,t=this,i=this.pool.pop();if(!i){if(this.used>=this.poolSize)return;this.used++,i=this.workerFactory()}var n=this.jobs.shift();n&&(e=i)[n.method].apply(e,Object(Z.a)(n.args)).then(n.y).catch(n.n).finally((function(){t.pool.push(i),t._nextJob()}))}}]),e}(),We=+(Object({NODE_ENV:"production",PUBLIC_URL:"/z-minus",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_HEADLESS_CORE_COUNT||4),qe=(De=Ye.a,new Ge(De,We)),Je=q.unitTypes,Ke=Je.triangleUT,Ze=Je.pentagonUT,$e=Je.scoutUT,Xe=Je.skirmisherUT,Qe=[Ze,Je.shielderBasicUT],et=[Ke,$e,Xe].flatMap((function(e){return Qe.map((function(t){return[e,t]}))})).map((function(e,t){var i=Object(ie.a)(e,2),n=i[0],a=i[1];return{off:n,def:a,index:t,name:"(".concat(n.displayName,", ").concat(a.displayName,")")}})),tt=et.flatMap((function(e){return et.filter((function(t){return t.index>e.index})).map((function(t){return{ut1:e,ut2:t,key:"".concat(e.name,"_").concat(t.name)}}))}));function it(e,t){for(var i=Object(ie.a)(e,2),n=i[0],a=i[1],r=t.winCount,s=t.durations,o=[0,0,0],l=[0,0,0],u=0;u<3;u++){var c=n[u],h=r[u],d=a[u],f=s[u];o[u]=c+h,l[u]=(d*n[u]+f*h)/Math.max(1,o[u])}return[o,l]}var nt=function(e){var t=e.green,i=e.red,n=e.results,r=Object(ie.a)(n,2),s=r[0],o=r[1],l=["Draw","Green (".concat(t.name,") Wins"),"Red (".concat(i.name,") Wins")];return a.a.createElement(a.a.Fragment,null,a.a.createElement("thead",null,a.a.createElement("tr",null,a.a.createElement("td",{colSpan:3},"\xa0")),a.a.createElement("tr",null,a.a.createElement("th",null,"".concat(t.name," vs ").concat(i.name)),a.a.createElement("th",null,"Count"),a.a.createElement("th",null,"Duration"))),a.a.createElement("tbody",null,l.map((function(e,t){return a.a.createElement("tr",{key:e},a.a.createElement("td",null,e),a.a.createElement("td",null,s[t]),a.a.createElement("td",null,Math.round(o[t])))}))))},at={started:!1,finished:!1,gamesPerLoop:25,loopCount:4,compareCount:tt.length,gameCount:25*tt.length*40,doneCount:0,results:Object.fromEntries(tt.map((function(e){return[e.key,[[0,0,0],[0,0,0]]]})))};function rt(e,t){if("change"===t.type){var i=Object(ce.a)({},e,Object(He.a)({},t.key,t.value));return i.gameCount=i.gamesPerLoop*i.loopCount*i.compareCount,i}var n=t.key,a=t.newResults,r=e.gamesPerLoop,s=e.loopCount,o=e.compareCount,l=e.doneCount,u=e.results[n],c=a.winCount,h=l+c[0]+c[1]+c[2];return Object(ce.a)({},e,{doneCount:h,gameCount:s*r*o,finished:h===r*s*o,results:Object(ce.a)({},e.results,Object(He.a)({},n,it(u,a)))})}var st=function(e){var t=e.keyV,i=e.text,n=e.disabled,r=e.value,s=e.dispatch;return a.a.createElement("tr",{className:"field"},a.a.createElement("th",null,i),a.a.createElement("td",{colSpan:2},a.a.createElement("input",{type:"text",value:r,disabled:n,onChange:function(e){return s({type:"change",key:t,value:+e.target.value})}})))},ot=function(){var e=Object(n.useReducer)(rt,at),t=Object(ie.a)(e,2),i=t[0],r=t[1],s=i.started,o=i.finished,l=i.doneCount,u=i.loopCount,c=i.gamesPerLoop,h=i.gameCount,d=Object(n.useCallback)((function(){r({type:"change",key:"started",value:!0}),tt.forEach((function(e){for(var t=e.ut1,i=e.ut2,n=e.key,a=0;a<u;a++)qe.simulateTeam(c,t.off.id,t.def.id,i.off.id,i.def.id).then((function(e){r({type:"result",key:n,newResults:e})}))}))}),[u,c,r]);return a.a.createElement("div",{className:"headless-app"},a.a.createElement("table",null,a.a.createElement("thead",null,a.a.createElement(st,{keyV:"loopCount",text:"Loop Count",disabled:s,value:u,dispatch:r}),a.a.createElement(st,{keyV:"gamesPerLoop",text:"Games Per Loop",disabled:s,value:c,dispatch:r}),a.a.createElement("tr",null,a.a.createElement("td",{colSpan:3},a.a.createElement("button",{onClick:d,disabled:s},s&&!o?"Simulating... ".concat(l,"/").concat(h):"Simulate".concat(o?"d":""," ").concat(h," games!"))))),tt.map((function(e){var t=e.ut1,n=e.ut2,r=e.key;return a.a.createElement(nt,{key:r,green:t,red:n,results:i.results[r]})}))))},lt="true"===Object({NODE_ENV:"production",PUBLIC_URL:"/z-minus",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_HEADLESS;s.a.render(a.a.createElement(a.a.StrictMode,null,lt?a.a.createElement(ot,null):a.a.createElement(Ae,null)),document.getElementById("root"))}},[[219,1,2]]]);
//# sourceMappingURL=main.aab86b50.chunk.js.map