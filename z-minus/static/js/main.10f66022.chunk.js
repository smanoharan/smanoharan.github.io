(this["webpackJsonpz-minus"]=this["webpackJsonpz-minus"]||[]).push([[0],{217:function(e,t,i){var n=i(233),a=["simulate"];e.exports=function(){var e=new Worker(i.p+"a8464e9a42557b7235ad.worker.js",{name:"[hash].worker.js"});return n(e,a),e}},219:function(e,t,i){e.exports=i(234)},224:function(e,t,i){},226:function(e,t,i){},231:function(e,t,i){},232:function(e,t,i){},234:function(e,t,i){"use strict";i.r(t);var n=i(23),a=i.n(n),r=i(213),o=i.n(r),s=(i(224),i(34)),l=i(65),c=i.n(l),h=c.a.mark(d),u=c.a.mark(v),f=c.a.mark(y);function d(e,t,i){var n,a;return c.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n=t.subtract(e.position).normalize(),a=n.clone();case 2:if(!(s.k.Dot(n,a)>0)){r.next=11;break}return n.normalize().scaleToRef(e.unitType.maxSpeed,e.velocity),void(r.next=6);case 6:if(!i(e)){r.next=8;break}return r.abrupt("break",11);case 8:t.subtractToRef(e.position,a),r.next=2;break;case 11:e.velocity.scaleInPlace(0);case 12:case"end":return r.stop()}}),h)}function v(e,t){return c.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return e.angularVelocity=Math.PI*(1===e.owner.id?3:-3),i.delegateYield(y(e,t),"t0",2);case 2:e.angularVelocity=0;case 3:case"end":return i.stop()}}),u)}function y(e,t){return c.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!t(e)){i.next=5;break}return void(i.next=3);case 3:i.next=0;break;case 5:case"end":return i.stop()}}),f)}function p(e){return Math.floor(Math.random()*e)}function m(e){if(e.length>0)return e[p(e.length)]}function g(e,t){if(0!==e.length){for(var i=e.map(t),n=p(function(e){for(var t=0,i=0;i<e.length;i++)t+=e[i];return t}(i)),a=0;a<i.length;a++)if((n-=i[a])<0)return e[a];return e[e.length-1]}}function w(e,t){return e.filter(t).length}var k=c.a.mark(M),b=c.a.mark(x),T=c.a.mark(P);function S(e){var t=e.tile;return!!t&&(t.occupancy[e.owner.opponent.id]>0||(t.owner===e.owner.opponent||(!(t.owner!==e.owner||!t.isDamaged()||!e.canRepairTile())||!(t!==e.owner.homeTile||!e.isDamaged()||!e.canRepairSelf()))))}function M(e,t,i){var n,a,r;return c.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:r=function(){return!a&&n?t.neighbourClosestTo(e.tile,n):e.isDamaged()&&e.unitType.repairSelf>0?t.neighbourClosestTo(e.tile,e.owner.homeTile):g(t.neighbours(e.tile),i)||e.owner.homeTile},n=e.owner.rallyTile,a=!n;case 3:if(!S){o.next=6;break}return o.delegateYield(v(e,S),"t0",6);case 6:return a=a||e.tile===n||!n,o.delegateYield(d(e,r().toPos(),S),"t1",8);case 8:o.next=3;break;case 10:case"end":return o.stop()}}),k)}function x(e,t){return c.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.delegateYield(M(e,t,(function(t){var i=t.owner.id,n=i===e.owner.id?1:0===i?2:3;return n*n*n})),"t0",1);case 1:case"end":return i.stop()}}),b)}function P(e,t){return c.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.delegateYield(M(e,t,(function(t){var i=t.owner.id===e.owner.id?2:1;return i*i*i})),"t0",1);case 1:case"end":return i.stop()}}),T)}var C={id:0,displayName:"Offensive",maxHealth:10,maxSpeed:1.5,attackVsUnit:4,attackVsTile:2,repairTile:.5,repairSelf:.5,meshFactory:function(e,t,i){var n={diameter:2*t,height:i,tessellation:3,enclose:!0};return s.g.CreateCylinder("offUnit",n,e)},aiFactory:function(e,t){return x(e,t)}},O={id:1,displayName:"Defensive",maxHealth:15,maxSpeed:2,attackVsUnit:3,attackVsTile:.25,repairTile:2,repairSelf:1,meshFactory:function(e,t,i){var n={diameter:1.7*t,height:i,tessellation:5,enclose:!0};return s.g.CreateCylinder("defUnit",n,e)},aiFactory:function(e,t){return P(e,t)}};var E,U={id:0,displayName:"Offensive",imgName:"off",nextUnitType:function(){return C}},j={id:1,displayName:"Defensive",imgName:"def",nextUnitType:function(){return O}},F={id:2,displayName:"Random",imgName:"rand",nextUnitType:function(){return m([C,O])}},_={minDurationState:.05,minDurationUI:.2,tileSize:2,drawnTileSize:1.96,unitCost:10,tileMaxHealth:20,homeTileMaxHealth:50,tileControlThreshold:.8,minUnitsToCapture:2,resourcesRate:1,unitTypes:[C,O],unitProdStrategies:[U,j,F],upsObj:{offenseOnlyUPS:U,defenseOnlyUPS:j,randomUPS:F},defaultUPS:F},z=i(50),I=i(54),D=i(75);function R(e,t){if(t(e),e.children)for(var i=0;i<e.children.length;i++)R(e.children[i],t)}!function(e){e[e.Game=0]="Game",e[e.Player=1]="Player",e[e.Board=2]="Board",e[e.Tile=3]="Tile",e[e.Unit=4]="Unit"}(E||(E={}));var H=function(){function e(t,i,n,a,r,o){var l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0;Object(z.a)(this,e),this.game=t,this.owner=i,this.isHome=n,this.resMult=a,this.type=E.Tile,this.name=void 0,this.viewMetaData=void 0,this.coords=void 0,this.health=void 0,this.maxHealth=void 0,this.occupancy=void 0,void 0===l?l=-(r+o):r+o+l!==0&&console.error("Attempting to create an invalid Tile",{q:r,r:o,s:l}),this.name="Tile[".concat(r,",").concat(o,",").concat(l,"]"),this.coords=new s.k(r,o,l),this.maxHealth=n?_.homeTileMaxHealth:_.tileMaxHealth,this.health=n?this.maxHealth:0,this.occupancy=[0,0,0]}return Object(I.a)(e,[{key:"generate",value:function(e){e.generateTile(this)}},{key:"updateLogic",value:function(e,t){var i=_.resourcesRate,n=_.tileControlThreshold;this.resolveUnits(this.game.aliveUnits,t),this.healthProportion()>n&&(this.owner.resourceCount+=t*i*this.resMult)}},{key:"draw",value:function(e){e.drawTile(this)}},{key:"equals",value:function(e){return this.coords.equals(e.coords)}},{key:"healthProportion",value:function(){return Math.min(1,Math.max(0,this.health/this.maxHealth))}},{key:"isDamaged",value:function(){return this.healthProportion()<.99}},{key:"incHealth",value:function(e,t){var i=this.health+e*t;this.health=Math.min(this.maxHealth,Math.max(0,i))}},{key:"harm",value:function(e,t){this.incHealth(-e,t)}},{key:"heal",value:function(e,t){this.incHealth(e,t)}},{key:"canCapture",value:function(e){return this.owner===this.game.gaia&&e.length>=_.minUnitsToCapture}},{key:"resolveUnits",value:function(e,t){var i=this,n=e.filter((function(e){return e.tile===i}));if(0!==n.length){var a=Object(D.a)(this.game.players,3),r=a[0],o=a[1],s=a[2],l=n.filter((function(e){return e.owner===o})),c=n.filter((function(e){return e.owner===s}));if(this.occupancy=[0,l.length,c.length],l.length>0&&c.length>0)l.forEach((function(e){return e.attackUnit(m(c),t)})),c.forEach((function(e){return e.attackUnit(m(l),t)}));else{var h=n[0].owner;this.canCapture(n)&&(this.owner=h),this.owner===h?n.forEach((function(e){return e.repair(i,t)})):this.owner!==r&&(n.forEach((function(e){return e.attackTile(i,t)})),this.healthProportion()<.1&&(this.owner=r))}}}},{key:"toPosOffset",value:function(e,t){var i=this.coords,n=i.x,a=i.y,r=n+e.x*t,o=a+e.y*t;return new s.k(1.5*r*_.tileSize,0,L*(.5*r+o)*_.tileSize)}},{key:"toPos",value:function(){return this.toPosOffset(s.k.Zero(),0)}}],[{key:"distBetween",value:function(e,t){var i=e.coords.subtract(t.coords),n=i.x,a=i.y,r=i.z;return.5*(Math.abs(n)+Math.abs(a)+Math.abs(r))}},{key:"roundCoords",value:function(e,t){var i=-e-t,n=Math.round(e),a=Math.round(t),r=Math.round(i),o=Math.abs(e-n),s=Math.abs(t-a),l=Math.abs(i-r);return o>Math.max(s,l)?{q:-a-r,r:a}:s>l?{q:n,r:-n-r}:{q:n,r:a}}}]),e}();H.direction={NN:new s.k(0,1,-1),NE:new s.k(1,0,-1),SE:new s.k(1,-1,0),SS:new s.k(0,-1,1),SW:new s.k(-1,0,1),NW:new s.k(-1,1,0)},H.directions=[H.direction.NN,H.direction.NE,H.direction.SE,H.direction.SS,H.direction.SW,H.direction.NW];var A,L=Math.sqrt(3),V=function(){function e(t,i,n){Object(z.a)(this,e),this.game=t,this.radius=i,this.type=E.Board,this.name="Board",this.children=void 0,this.tiles=void 0,this.tiles=[],this.children=[];for(var a=i,r=-a;r<=a;r++){this.tiles[r+a]=[];for(var o=-a;o<=a;o++){var s=-(r+o);if(-a<=s&&s<=a&&n(r,o,s)){var l=0===r&&Math.abs(o)===a,c=t.players[l?o===a?1:2:0],h=Math.abs(r)<=1&&Math.abs(s-o)>=2,u=new H(t,c,l,l||s===o?2:h?.5:1,r,o);this.tiles[r+a][o+a]=u,this.children.push(u)}}}}return Object(I.a)(e,[{key:"tile",value:function(e,t){var i=this.radius;if(-i<=e&&e<=i&&-i<=t&&t<=i)return this.tiles[e+i][t+i]}},{key:"tileList",value:function(){return this.children}},{key:"neighbours",value:function(e){var t=this;return H.directions.map((function(i){return t.neighbour(e,i)})).filter((function(e){return!!e}))}},{key:"neighbourClosestTo",value:function(e,t){var i=this.neighbours(e);if(0===i.length)return t;for(var n=i.map((function(e){return H.distBetween(e,t)})),a=0,r=1;r<i.length;r++)n[r]<n[a]&&(a=r);return i[a]}},{key:"neighbour",value:function(e,t){return this.tile(e.coords.x+t.x,e.coords.y+t.y)}},{key:"posToTile",value:function(e){var t=e.x/_.tileSize,i=e.z/_.tileSize,n=H.roundCoords(2/3*t,(N*i-t)/3),a=n.q,r=n.r;return this.tile(a,r)}}]),e}(),N=Math.sqrt(3),B=function(){function e(t,i,n,a,r){Object(z.a)(this,e),this.game=t,this.id=i,this.name=n,this.hue=a,this.maxSaturation=r,this.type=E.Player,this.viewMetaData=void 0,this.stdTileColor=void 0,this.homeTileColor=void 0,this.fullUnitColor=void 0,this.deadUnitColor=void 0,this.opponent=void 0,this.homeTile=void 0,this.rallyTile=void 0,this.resourceCount=void 0,this.ups=void 0,this.stdTileColor=e.color(a,.4*r,.8),this.homeTileColor=e.color(a,.8*r,.6),this.fullUnitColor=e.color(a,.95*r,.95),this.deadUnitColor=e.color(a,.4*r,.3,.3),this.resourceCount=0,this.ups=_.defaultUPS,this.homeTile=void 0,this.rallyTile=void 0,this.opponent=void 0}return Object(I.a)(e,[{key:"generate",value:function(e){var t=this;this.homeTile=this.game.board.tileList().find((function(e){return e.owner===t&&e.isHome})),this.opponent=this.game.players.find((function(e){return e.id>0&&e.id!==t.id})),e.generatePlayer(this)}},{key:"updateLogic",value:function(e,t){for(;this.resourceCount>=_.unitCost;)this.resourceCount-=_.unitCost,this.game.spawnUnit(this,this.ups.nextUnitType(),this.homeTile)}},{key:"draw",value:function(e){e.drawPlayer(this)}},{key:"isAlive",value:function(){return this.homeTile.owner===this}},{key:"tileColor",value:function(t,i,n){var a=(t?.8:.4)*i*this.maxSaturation,r=(t?.6:.8)+(n?.1:0);return e.color(this.hue,a,r)}}],[{key:"color",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=new s.b;s.b.HSVtoRGBToRef(e,t,i,a);var r=a.r,o=a.g,l=a.b;return new s.c(r,o,l,n)}}]),e}();!function(e){e[e.active=0]="active",e[e.dead=1]="dead",e[e.won=2]="won",e[e.lost=3]="lost"}(A||(A={}));var Y=2*Math.PI,W=function(){function e(t,i,n,a,r,o){Object(z.a)(this,e),this.game=t,this.id=i,this.owner=n,this.unitType=a,this.tile=r,this.position=o,this.type=E.Unit,this.name=void 0,this.viewMetaData=void 0,this.state=void 0,this.velocity=void 0,this.angularVelocity=void 0,this.rotY=void 0,this.health=void 0,this.ai=void 0,this.name="Unit[".concat(i,"]"),this.state=A.active,this.velocity=new s.k,this.angularVelocity=0,this.rotY=0,this.health=this.unitType.maxHealth,this.ai=void 0}return Object(I.a)(e,[{key:"generate",value:function(e){e.generateUnit(this),this.ai=this.unitType.aiFactory(this,this.game.board)}},{key:"updateFrame",value:function(e,t){if(this.state!==A.dead&&this.state!==A.lost){this.velocity.scaleAndAddToRef(t,this.position);var i=this.rotY+this.angularVelocity*t;i>=Y?i-=Y:i<0&&(i+=Y),this.rotY=i}var n=.05+.01*this.owner.id;switch(this.state){case A.active:this.position.y=n;break;case A.won:var a=.2*(this.id%3+1)*(.8+Math.sin(this.rotY));this.position.y=n+Math.max(0,a);break;case A.lost:case A.dead:this.position.y=n-.001}}},{key:"updateLogic",value:function(e,t){this.health<=.001&&this.setState(A.dead),this.state===A.active&&(this.ai.next(t),this.tile=this.game.board.posToTile(this.position)||this.owner.homeTile,(Math.abs(this.velocity.x)>.01||Math.abs(this.velocity.z)>.01)&&(this.rotY=Math.atan2(this.velocity.x,this.velocity.z)))}},{key:"draw",value:function(e){e.drawUnit(this)}},{key:"healthProportion",value:function(){return this.health/this.unitType.maxHealth}},{key:"incHealth",value:function(e,t){var i=this.health+e*t;this.health=Math.min(this.unitType.maxHealth,Math.max(0,i))}},{key:"harm",value:function(e,t){this.incHealth(-e,t)}},{key:"heal",value:function(e,t){this.incHealth(e,t)}},{key:"attackUnit",value:function(e,t){e.harm(this.unitType.attackVsUnit,t)}},{key:"attackTile",value:function(e,t){e.harm(this.unitType.attackVsTile,t)}},{key:"repair",value:function(e,t){e.heal(this.unitType.repairTile,t),this.game.canHeal(this,e)&&this.heal(this.unitType.repairSelf,t)}},{key:"isAlive",value:function(){return this.state===A.active||this.state===A.won}},{key:"isDamaged",value:function(){return this.healthProportion()<.99}},{key:"canRepairSelf",value:function(){return this.unitType.repairSelf>.01}},{key:"canRepairTile",value:function(){return this.unitType.repairTile>.01}},{key:"setState",value:function(e){if(this.state!==e){switch(e){case A.won:this.velocity.scaleInPlace(0),this.angularVelocity=this.id%4*2-3;break;case A.dead:case A.lost:this.ai=void 0,this.velocity.scaleInPlace(0)}this.state=e}}}]),e}(),G=function(){function e(){Object(z.a)(this,e),this.type=E.Game,this.name="Game",this.children=void 0,this.view=void 0,this.players=void 0,this.gaia=void 0,this.board=void 0,this.aliveUnits=void 0,this.winner=void 0,this.gaia=new B(this,0,"Gaia",180,.01);var t=new B(this,1,"Green",120,1),i=new B(this,2,"Red",0,1);this.players=[this.gaia,t,i],this.board=new V(this,2,(function(){return!0})),this.aliveUnits=[],this.winner=void 0,this.children=[this.board,t,i]}return Object(I.a)(e,[{key:"generate",value:function(e){this.view=e}},{key:"updateLogic",value:function(e,t){this.aliveUnits=this.children.filter((function(e){return e.type===E.Unit&&e.isAlive()}))}},{key:"startGame",value:function(){var e=Object(D.a)(this.players,3),t=e[1],i=e[2],n=this.board.neighbours(t.homeTile),a=this.board.neighbours(i.homeTile),r=Object(D.a)(_.unitTypes,2),o=r[0],s=r[1];this.spawnUnit(i,s,i.homeTile),this.spawnUnit(t,s,t.homeTile),this.spawnUnit(i,o,a[0]),this.spawnUnit(t,o,n[1])}},{key:"spawnUnit",value:function(e,t,i){var n=this.children.length,a=new W(this,n,e,t,i,i.toPos());this.view&&a.generate(this.view),this.children.push(a),this.aliveUnits.push(a)}},{key:"running",value:function(){if(!this.winner){var e=Object(D.a)(this.players,3),t=e[1],i=e[2];t.isAlive()?i.isAlive()||this.finishGame(t):this.finishGame(i)}return void 0===this.winner}},{key:"finishGame",value:function(e){this.winner=e;for(var t=0;t<this.children.length;t++){var i=this.children[t];if(i.type===E.Unit){var n=i;n.setState(n.isAlive()&&n.owner===e?A.won:A.lost)}}}},{key:"canHeal",value:function(e,t){return t.isHome&&e.owner===t.owner&&t.healthProportion()>_.tileControlThreshold}},{key:"allowSelect",value:function(e){return e.type===E.Tile}},{key:"toggleRallyTile",value:function(e,t){e.rallyTile=e.rallyTile===t?void 0:t}},{key:"select",value:function(e,t){t.type===E.Tile&&this.toggleRallyTile(e,t)}}]),e}(),q=i(214),J=i(147),K=i(218),Z=(i(226),{marginTop:"0.5em",marginLeft:"0.25em",marginRight:"0.25em",width:"8em",height:"8em",backgroundSize:"contain",outline:"none",boxShadow:"none",border:0}),X=function(e){var t=e.text,i=e.active,n=e.onClick,r=e.style,o=Object(J.a)({},Z,{},r,{backgroundColor:i?"white":"transparent",transition:i?"background-color 0.5s":"background-color 5s cubic-bezier(.01,.80,.65,.93) 0s"}),s="option-button-"+(i?"active":"clickable");return a.a.createElement(K.a.button,{style:o,onClick:n,className:s},t)},$={zIndex:100,color:"whitesmoke",margin:"auto",fontSize:"1em"},Q=function(e){var t=e.view,i=e.style,r=e.getMessage,o=Object(n.useState)(""),s=Object(D.a)(o,2),l=s[0],c=s[1];Object(n.useEffect)(t.useListenerEffect((function(){return c(r(t))})),[t,c,r]);var h=i?Object(J.a)({},$,{},i):$;return a.a.createElement("div",{style:h},l)},ee={position:"absolute",zIndex:99,padding:"10px",bottom:0,margin:"auto"},te=function(e){var t=e.view,i=e.playerIndex,r=e.style,o=Object(n.useCallback)((function(){return t.getPlayerStatus(i)}),[t,i]),s=Object(n.useState)(void 0),l=Object(D.a)(s,2),c=l[0],h=l[1];Object(n.useEffect)(t.useListenerEffect((function(){return h(t.getPlayerUPS(i))})),[t,h,i]);var u=r?Object(J.a)({},ee,{},r):ee;return a.a.createElement("div",{style:u},a.a.createElement(Q,{view:t,getMessage:o}),_.unitProdStrategies.map((function(e){return a.a.createElement(X,{key:e.id,text:"",active:e===c,style:{backgroundImage:'url("/z-minus/img/'.concat(e.imgName,"-").concat(i,'.png")')},onClick:function(){return t.setPlayerUPS(i,e)}})})))},ie=(i(212),i(215)),ne=i.n(ie),ae=i(216),re=i.n(ae),oe=function(){function e(t,i,n){Object(z.a)(this,e),this.instances=t,this.globalScale=i,this.globalRotY=n}return Object(I.a)(e,[{key:"setColour",value:function(e){for(var t=0;t<this.instances.length;t++)this.instances[t].z_is_colorable&&(this.instances[t].instancedBuffers.color=e)}},{key:"setScale",value:function(e){for(var t=0;t<this.instances.length;t++)this.instances[t].z_is_root&&this.instances[t].scaling.setAll(e*this.globalScale)}},{key:"setPosition",value:function(e){for(var t=0;t<this.instances.length;t++)this.instances[t].z_is_root&&this.instances[t].position.copyFrom(e)}},{key:"setRotationY",value:function(e){for(var t=0;t<this.instances.length;t++)this.instances[t].rotation.y=this.globalRotY+e}},{key:"setVisible",value:function(e){for(var t=0;t<this.instances.length;t++)this.instances[t].z_is_root&&(this.instances[t].isVisible=e)}},{key:"setPickable",value:function(e){for(var t=0;t<this.instances.length;t++)this.instances[t].z_is_root&&(this.instances[t].isPickable=e)}},{key:"setMetaData",value:function(e){for(var t=0;t<this.instances.length;t++)this.instances[t].metadata=e}}],[{key:"toDrawnAtom",value:function(e,t,i){var n=e;return n.z_is_root=!e.parent,n.z_index=t,n.z_is_colorable=i,n}},{key:"fromSingle",value:function(t){return new e([this.toDrawnAtom(t,0,!0)],1,0)}}]),e}(),se=function(){function e(t){Object(z.a)(this,e),this.factory=t,this.prototype=void 0,this.prototype=void 0}return Object(I.a)(e,[{key:"getMeshInstance",value:function(e,t,i){this.prototype||(this.prototype=this.factory(e),this.prototype.isVisible=!1,this.prototype.isPickable=!1);var n=this.prototype.createInstance(t);return n.position.copyFrom(i||this.prototype.position),n.isVisible=!0,n.isPickable=!0,oe.fromSingle(n)}}]),e}(),le=function(){function e(t,i,n,a,r){Object(z.a)(this,e),this.fileName=t,this.scale=i,this.rotY=n,this.colorAll=a,this.scene=r,this.prototypes=void 0,this.prototypes=void 0}return Object(I.a)(e,[{key:"process",value:function(e){this.prototypes=e;for(var t=0;t<this.prototypes.length;t++){var i=this.prototypes[t];i.parent||i.scaling.setAll(this.scale),(this.colorAll||i.material&&"Player Primary"===i.material.name)&&i.geometry&&i.geometry.getTotalVertices()>0&&(i.registerInstancedBuffer("color",4),i.instancedBuffers.color=new s.c(1,1,1,1),i.useVertexColors=!0,i.z_color=!0),i.z_loaded_index=t,i.isVisible=!1,i.isPickable=!1}return this.prototypes}},{key:"load",value:function(){var e=this;return s.i.ImportMeshAsync("","z-minus/assets/",this.fileName,this.scene).then((function(t){var i=t.meshes;return e.process(i)}))}},{key:"getMeshInstance",value:function(e,t){var i=this;ne()(!!this.prototypes,"attempting to call getMeshInstance before models loaded");for(var n=this.prototypes.map((function(t,n){return oe.toDrawnAtom(t.geometry&&t.geometry.getTotalVertices()>0?t.createInstance("".concat(e,"[").concat(n,"]")):new s.f("".concat(e,"[").concat(n,"]"),i.scene),n,t.z_color)})),a=0;a<n.length;a++){n[a].z_is_colorable&&(n[a].instancedBuffers.color=new s.c(1,1,1,1)),n[a].isVisible=!0,n[a].isPickable=!0;var r=this.prototypes[a].parent;r&&(n[a].parent=n[r.z_loaded_index])}return t&&n[0].position.copyFrom(t),new oe(n,this.scale,this.rotY)}}]),e}(),ce=function(){function e(t){Object(z.a)(this,e),this.factory=t,this.prototype=void 0,this.prototype={}}return Object(I.a)(e,[{key:"getMeshInstance",value:function(e,t,i,n,a){if(!this.prototype[t]){var r=this.factory(e,i);r.isVisible=!1,r.isPickable=!1,this.prototype[t]=r}var o=this.prototype[t],s=o.createInstance(n);return s.position.copyFrom(a||o.position),s.isVisible=!0,s.isPickable=!0,oe.fromSingle(s)}}]),e}();function he(e){var t={radius:_.drawnTileSize,tessellation:6,sideOrientation:s.f.DOUBLESIDE},i=s.g.CreateDisc("tileMesh",t,e);i.rotation.x=.5*Math.PI;var n=new s.j("tileMeshMaterial",e);return n.specularColor=new s.b(.5,.6,.87),i.material=n,i.receiveShadows=!0,i.registerInstancedBuffer("color",4),i.instancedBuffers.color=new s.c(1,1,1,1),i}function ue(e){var t={width:.07*_.drawnTileSize,depth:.05,height:.07*_.drawnTileSize},i=s.g.CreateBox("resourceMesh",t,e);i.rotation.x=.5*Math.PI;var n=new s.j("resMeshMaterial",e);return n.specularColor=new s.b(.5,.6,.87),n.diffuseColor=new s.b(1,.9,0),i.material=n,i.receiveShadows=!1,i}function fe(e,t){var i=new s.j("unitMeshMaterial",e);i.specularColor=new s.b(.8,.8,.9);var n=t.unitType.meshFactory(e,.4,.1);return n.material=i,n.isVisible=!1,n.registerInstancedBuffer("color",4),n.instancedBuffers.color=new s.c(1,1,1,1),n}function de(e){var t=.05,i=.75*_.drawnTileSize,n=.55*i,a=i-n,r=[new s.k(-t,0,0),new s.k(t,0,0),new s.k(t,0,n),new s.k(a,0,n),new s.k(a,0,i),new s.k(t,0,i),new s.k(-t,0,i)],o=s.g.ExtrudePolygon("rallyFlagMesh",{shape:r,depth:.1},e,re.a);o.rotation.x=-.5*Math.PI;var l=new s.j("rallyFlagMaterial",e);return l.specularColor=new s.b(.5,.6,.87),o.material=l,o.receiveShadows=!1,o.registerInstancedBuffer("color",4),o.instancedBuffers.color=new s.c(1,1,1,1),o}var ve=function(){function e(t){Object(z.a)(this,e),this.scene=t,this.tileFactory=void 0,this.resourceFactory=void 0,this.rallyFlagFactory=void 0,this.unitFactory=void 0,this.spireFactory=void 0,this.charlieFactory=void 0,this.offenseFactory=void 0,this.deltaFactory=void 0,this.tileFactory=new se(he),this.resourceFactory=new se(ue),this.rallyFlagFactory=new se(de),this.unitFactory=new ce(fe),this.spireFactory=new le("spire.gltf",.2,0,!0,t),this.charlieFactory=new le("charlie.glb",.2,0,!0,t),this.offenseFactory=new le("offense.glb",.25,0,!0,t),this.deltaFactory=new le("delta.glb",.2,0,!1,t)}return Object(I.a)(e,[{key:"loadAll",value:function(){var e=this;return this.spireFactory.load().then((function(){return e.charlieFactory.load()})).then((function(){return e.offenseFactory.load()})).then((function(){return e.deltaFactory.load()})).then((function(){return e}))}},{key:"makeTileMesh",value:function(e){return this.tileFactory.getMeshInstance(this.scene,e.name,e.toPos())}},{key:"makeResourceMesh",value:function(e,t){var i=e.toPosOffset(H.directions[t],.3),n=this.resourceFactory.getMeshInstance(this.scene,"".concat(e.name,"[").concat(t,"]"),i);return n.setRotationY(t*Math.PI/6),n}},{key:"makeRallyFlagMesh",value:function(e){var t="".concat(e.name,"/rally"),i=this.rallyFlagFactory.getMeshInstance(this.scene,t);return i.setPickable(!1),i}},{key:"makeUnitMesh",value:function(e){var t=e.name,i=e.position,n=e.unitType,a=e.owner,r=0===n.id?this.offenseFactory.getMeshInstance(t,i):this.deltaFactory.getMeshInstance(t,i);return r.setColour(a.fullUnitColor),r}}]),e}(),ye=function(){function e(t){Object(z.a)(this,e),this.game=t,this.generated=void 0,this.scene=void 0,this.meshCache=void 0,this.listeners=void 0,this.elapsedSinceState=0,this.elapsedSinceUI=0,this.hovering=null,this.listeners=[],this.scene=void 0,this.meshCache=void 0,this.generated=!1}return Object(I.a)(e,[{key:"generate",value:function(e){var t=this;if(!this.generated){e.useRightHandedSystem=!0,this.scene=e,this.meshCache=new ve(this.scene),this.scene.ambientColor=new s.b(1,1,1);var i=new s.a("camera1",0,0,10,new s.k(0,6,16),this.scene);i.lowerBetaLimit=.1,i.upperBetaLimit=Math.PI/2*.8,i.lowerRadiusLimit=10,i.upperRadiusLimit=100,i.setTarget(s.k.Zero());var n=this.scene.getEngine().getRenderingCanvas();i.attachControl(n,!0);for(var a=[new s.e("light",new s.k(0,1,-2),this.scene),new s.e("light",new s.k(1,1,1),this.scene),new s.e("light",new s.k(-1,1,1),this.scene)],r=0;r<a.length;r++)a[r].intensity=.4;this.scene.onPointerPick=function(e,i){var n=i.pickedMesh;if(n&&n.metadata){var a=0===e.button?1:2,r=t.game.players[a];t.game.select(r,n.metadata)}},this.meshCache.loadAll().then((function(){R(t.game,(function(e){return e.generate&&e.generate(t)})),t.game.startGame(),t.generated=!0}))}}},{key:"ifElapsed",value:function(e,t,i,n){var a=e+t;return a>i?(n.call(this,a),0):a}},{key:"render",value:function(){var e=this;if(this.generated){var t=this.scene.pick(this.scene.pointerX,this.scene.pointerY),i=t&&t.hit&&t.pickedMesh&&t.pickedMesh.metadata;i&&!this.game.allowSelect(i)&&(i=this.hovering),this.hovering=i;var n=this.scene.getEngine().getDeltaTime(),a=Math.min(50,n)/1e3;this.elapsedSinceState=this.ifElapsed(this.elapsedSinceState,a,_.minDurationState,this.updateState),this.elapsedSinceUI=this.ifElapsed(this.elapsedSinceUI,a,_.minDurationUI,this.updateUI),R(this.game,(function(t){t.updateFrame&&t.updateFrame(e,a),t.draw&&t.draw(e)}))}}},{key:"updateState",value:function(e){var t=this;this.game.running()&&R(this.game,(function(i){return i.updateLogic&&i.updateLogic(t,e)}))}},{key:"updateUI",value:function(e){for(var t=0;t<this.listeners.length;t++)this.listeners[t]()}},{key:"addListener",value:function(e){this.listeners.push(e)}},{key:"removeListener",value:function(e){this.listeners=this.listeners.filter((function(t){return t!==e}))}},{key:"useListenerEffect",value:function(e){var t=this;return function(){return t.addListener(e),function(){return t.removeListener(e)}}}},{key:"generateUnit",value:function(e){var t=this.meshCache.makeUnitMesh(e);e.viewMetaData=t,t.setMetaData(e)}},{key:"drawUnit",value:function(e){var t=e.viewMetaData;e.isAlive()||t.setColour(e.owner.deadUnitColor),t.setScale(.5+.5*e.healthProportion()),t.setPosition(e.position),t.setRotationY(e.rotY)}},{key:"generateTile",value:function(e){var t=this.meshCache.makeTileMesh(e);e.viewMetaData=t,t.setMetaData(e);for(var i=e.resMult,n=i<.75?3:2,a=(e.coords.x+n)%n,r=0;r<H.directions.length;r++)(i>1.5||i<.75&&r%3===a||i>=.75&&r%2===a)&&this.meshCache.makeResourceMesh(e,r)}},{key:"drawTile",value:function(e){e.viewMetaData.setColour(e.owner.tileColor(e.isHome,e.healthProportion(),this.hovering===e))}},{key:"generatePlayer",value:function(e){var t=this.meshCache.makeRallyFlagMesh(e);t.setColour(e.homeTileColor),e.viewMetaData=t,t.setMetaData(e)}},{key:"drawPlayer",value:function(e){var t=e.viewMetaData;if(t.setVisible(!!e.rallyTile),e.rallyTile){var i=e.rallyTile.toPos().clone();if(e.rallyTile===e.opponent.rallyTile){var n=1===e.id?1:-1;i.x+=.15*_.drawnTileSize*n,i.z+=.25*_.drawnTileSize*n}t.setPosition(i)}}},{key:"gameWinnerMessage",value:function(){return this.game.winner?"".concat(this.game.winner.name," wins!"):""}},{key:"getFPS",value:function(){return Math.round(this.scene.getEngine().getFps())}},{key:"getPlayerStatus",value:function(e){var t=this.game.players[e],i=Math.floor(t.resourceCount),n=w(this.game.board.tileList(),(function(e){return e.owner===t})),a=w(this.game.aliveUnits,(function(e){return e.owner===t}));return"".concat(t.name,": $").concat(i,", ").concat(n," tile(s), ").concat(a," unit(s)")}},{key:"getPlayerUPS",value:function(e){return this.game.players[e].ups}},{key:"setPlayerUPS",value:function(e,t){this.game.players[e].ups=t,this.updateUI(0)}}]),e}();function pe(e){return"FPS: ".concat(e.getFPS())}var me={position:"absolute",top:0,right:0,opacity:.8,padding:"0.5em"};function ge(e){return e.gameWinnerMessage()}var we,ke={position:"absolute",top:"25vh",left:0,right:0,fontSize:"6em",textAlign:"center",textShadow:"#111 3px 3px"},be={left:0,textAlign:"left",borderRight:"1px dashed forestgreen",borderTop:"1px dashed forestgreen"},Te={right:0,textAlign:"right",borderLeft:"1px dashed red",borderTop:"1px dashed red"},Se=function(e){var t=e.game,i=Object(n.useMemo)((function(){return new ye(t)}),[t]);return a.a.createElement(a.a.Fragment,null,a.a.createElement(Q,{view:i,style:ke,getMessage:ge}),a.a.createElement(Q,{view:i,style:me,getMessage:pe}),a.a.createElement(q.a,{antialias:!0,onSceneReady:function(e){return i.generate(e)},onRender:function(){return i.render()},id:"game-canvas"}),a.a.createElement(te,{view:i,playerIndex:1,style:be}),a.a.createElement(te,{view:i,playerIndex:2,style:Te}))},Me=(i(231),function(){var e=Object(n.useMemo)((function(){return new G}),[]);return a.a.createElement("div",{className:"fullscreen"},a.a.createElement(Se,{game:e}))}),xe=(i(232),i(217)),Pe=i.n(xe),Ce=i(134),Oe=function(){function e(t,i){Object(z.a)(this,e);var n=(this.workerFactory=t)();for(var a in this.poolSize=i||4,this.used=1,this.pool=[n],this.jobs=[],n)n.hasOwnProperty(a)&&"function"===typeof n[a]&&(this[a]=this._method(a))}return Object(I.a)(e,[{key:"_method",value:function(e){var t=this;return function(){for(var i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return t._queueJob(e,n)}}},{key:"_queueJob",value:function(e,t){var i=this;return new Promise((function(n,a){i.jobs.push({method:e,args:t,y:n,n:a}),i._nextJob()}))}},{key:"_nextJob",value:function(){var e,t=this,i=this.pool.pop();if(!i){if(this.used>=this.poolSize)return;this.used++,i=this.workerFactory()}var n=this.jobs.shift();n&&(e=i)[n.method].apply(e,Object(Ce.a)(n.args)).then(n.y).catch(n.n).finally((function(){t.pool.push(i),t._nextJob()}))}}]),e}(),Ee=+(Object({NODE_ENV:"production",PUBLIC_URL:"/z-minus",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_HEADLESS_CORE_COUNT||4),Ue=(we=Pe.a,new Oe(we,Ee)),je=["Draw","Green Wins","Red Wins"];function Fe(e,t){for(var i=Object(D.a)(e,2),n=i[0],a=i[1],r=t.winCount,o=t.durations,s=[0,0,0],l=[0,0,0],c=0;c<3;c++){var h=n[c],u=r[c],f=a[c],d=o[c];s[c]=h+u,l[c]=(f*n[c]+d*u)/Math.max(1,s[c])}return[s,l]}var _e=function(){var e=Object(n.useState)(!1),t=Object(D.a)(e,2),i=t[0],r=t[1],o=Object(n.useState)([[0,0,0],[0,0,0]]),s=Object(D.a)(o,2),l=s[0],c=s[1],h=Object(D.a)(l,2),u=h[0],f=h[1],d=u[0]+u[1]+u[2];Object(n.useEffect)((function(){i&&d>=1e4&&r(!1)}),[i,r,d]);return a.a.createElement("div",{className:"headless-app"},a.a.createElement("table",null,a.a.createElement("thead",null,a.a.createElement("tr",null,a.a.createElement("th",null,"Result"),a.a.createElement("th",null,"Count"),a.a.createElement("th",null,"Duration"))),a.a.createElement("tbody",null,je.map((function(e,t){return a.a.createElement("tr",{key:e},a.a.createElement("td",null,e),a.a.createElement("td",null,u[t]),a.a.createElement("td",null,Math.round(f[t])))}))),a.a.createElement("tfoot",null,a.a.createElement("tr",null,a.a.createElement("td",{colSpan:3},a.a.createElement("button",{onClick:function(){r(!0),c([[0,0,0],[0,0,0]]);for(var e=0;e<400;e++)Ue.simulate(25).then((function(e){c((function(t){return Fe(t,e)}))}))},disabled:i},i?"Simulating... ".concat(d,"/").concat(1e4):"Simulate ".concat(1e4," games!")))))))},ze="true"===Object({NODE_ENV:"production",PUBLIC_URL:"/z-minus",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_HEADLESS;o.a.render(a.a.createElement(a.a.StrictMode,null,ze?a.a.createElement(_e,null):a.a.createElement(Me,null)),document.getElementById("root"))}},[[219,1,2]]]);
//# sourceMappingURL=main.10f66022.chunk.js.map