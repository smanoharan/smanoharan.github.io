{"version":3,"sources":["ai/actions.ts","util/util.ts","ai/randomWalk.ts","core/config.ts","core/tile.ts","core/board.ts","core/player.ts","core/unit.ts","core/view.ts","core/game.ts","ui/Alert.tsx","ui/ControlPanel.tsx","ui/GameScene.tsx","ui/Stats.tsx","App.tsx","index.tsx"],"names":["moveTowards","doWorkWhile","waitWhile","unit","target","interrupt","targetDirection","subtract","position","normalize","curDirection","clone","Vector3","Dot","scaleToRef","unitType","maxSpeed","velocity","subtractToRef","scaleInPlace","pred","angularVelocity","Math","PI","owner","id","randomInt","max","floor","random","randomElem","array","length","randomWeightedElem","weight","weights","map","selected","sum","i","randomWalkAI","offensiveUnitAI","defensiveUnitAI","canDoWork","curTile","tile","occupancy","opponent","healthProportion","homeTile","isDamaged","board","tilePref","nextTile","neighbourClosestTo","neighbours","toPos","t","diff","abs","offenseUT","displayName","maxHealth","attackVsUnit","attackVsTile","repairTile","repairSelf","meshFactory","scene","radius","height","options","diameter","tessellation","enclose","MeshBuilder","CreateCylinder","aiFactory","defenseUT","randomUPS","className","nextUnitType","minDurationState","tileSize","drawnTileSize","unitCost","tileMaxHealth","homeTileMaxHealth","tileControlThreshold","minUnitsToCapture","resourcesRate","unitTypes","unitProdStrategies","defaultUPS","Tile","game","isHome","resMult","q","r","s","undefined","coords","health","mesh","console","error","this","config","view","makeTileMesh","d","a","x","directions","makeResourceMesh","other","equals","min","_elapsed","elapsed","resolveUnits","aliveUnits","instancedBuffers","color","tileColor","resourceCount","rate","newHealth","incHealth","occupiers","gaia","units","unitsOnTile","filter","u","players","p1","p2","p1Units","p2Units","forEach","attackUnit","soleOccupier","canCapture","repair","attackTile","dir","amount","y","nx","ny","sqrt3","toPosOffset","Zero","b","z","qf","rf","sf","round","qDist","rDist","sDist","direction","NN","NE","SE","SS","SW","NW","sqrt","Board","acceptTile","tiles","tileList","R","isHomeAdjacent","push","generate","updateDrawn","updateState","neighbour","dist","n","distBetween","closest","pos","roundCoords","countIf","predicate","UnitState","Player","name","hue","maxSaturation","stdTileColor","homeTileColor","fullUnitColor","deadUnitColor","ups","_scene","find","p","spawnUnit","resCount","tileCount","unitCount","saturation","value","alpha","result","Color3","HSVtoRGBToRef","g","Color4","TwoPI","Unit","ai","state","targetAngle","active","makeUnitMesh","minY","updatePhysics","won","sin","rotation","scaleAndAddToRef","copyFrom","rotY","setState","dead","next","posToTile","dot","Forward","acos","scaling","setAll","harm","heal","canHeal","lost","View","shadows","ambientColor","camera","ArcRotateCamera","lowerBetaLimit","upperBetaLimit","lowerRadiusLimit","upperRadiusLimit","setTarget","canvas","getEngine","getRenderingCanvas","attachControl","lights","HemisphericLight","intensity","castShadow","addShadowCaster","tileMesh","generateTileMesh","onAddMesh","meshInst","createInstance","isVisible","index","resourceMesh","generateResourceMesh","unitMesh","generateUnitMesh","unitMeshPrototype","material","StandardMaterial","specularColor","CreateDisc","sideOrientation","Mesh","DOUBLESIDE","receiveShadows","registerInstancedBuffer","diffuseColor","width","CreateBox","depth","Game","allUnits","winner","listeners","elapsedSinceState","player1","player2","reset","first","second","firstAdj","secondAdj","off","def","nextId","running","isAlive","player","finishGame","notifyListeners","listener","l","current","AlertUI","onGetMessage","outRef","alertRef","useRef","updateAlert","useCallback","innerText","useEffect","ref","ControlPanelBtn","onClick","fullClassName","disabled","ControlPanelStrategyBtn","btnUps","curUps","onSet","ControlPanelUI","playerRef","useState","setUps","updatePlayerStatus","statusDisplayText","key","GameSceneUI","antialias","onSceneReady","onRender","actualElapsedMillis","getDeltaTime","elapsedMillis","update","StatsUI","fpsRef","updateStats","fps","getFps","App","useMemo","statsRef","p1Ref","p2Ref","addGameStateListenerEffect","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.e673be25.chunk.js","sourcesContent":["import { Vector3 } from '@babylonjs/core';\nimport { Unit } from '../core';\n\nexport type Predicate = (unit: Unit) => boolean;\n\nexport function* moveTowards(\n  unit: Unit,\n  target: Vector3,\n  interrupt: Predicate\n) {\n  const targetDirection = target.subtract(unit.position).normalize();\n  let curDirection = targetDirection.clone();\n\n  while (Vector3.Dot(targetDirection, curDirection) > 0) {\n    targetDirection\n      .normalize()\n      .scaleToRef(unit.unitType.maxSpeed, unit.velocity);\n\n    yield; // wait for next update\n\n    if (interrupt(unit)) break;\n\n    target.subtractToRef(unit.position, curDirection);\n  }\n\n  unit.velocity.scaleInPlace(0);\n}\n\nexport function* doWorkWhile(unit: Unit, pred: Predicate) {\n  unit.angularVelocity = Math.PI * (unit.owner.id === 1 ? 3 : -3);\n  yield* waitWhile(unit, pred);\n  unit.angularVelocity = 0;\n}\n\nexport function* waitWhile(unit: Unit, pred: Predicate) {\n  while (pred(unit)) {\n    yield;\n  }\n}\n\nexport function* waitUntil(unit: Unit, pred: Predicate) {\n  while (!pred(unit)) {\n    yield;\n  }\n}\n\nexport function* wait(duration: number) {\n  let elapsed = 0;\n  while (elapsed < duration) {\n    elapsed += yield;\n  }\n}\n","export type WeightFn<T> = (t: T) => number;\n\nexport function randomInt(max: number): number {\n  return Math.floor(Math.random() * max);\n}\n\nexport function randomElem<T>(array: T[]): T | undefined {\n  if (array.length > 0) {\n    return array[randomInt(array.length)];\n  }\n  return undefined;\n}\n\nfunction sum(array: number[]): number {\n  // simpler to under than reduce\n  let sum = 0;\n  for (let i = 0; i < array.length; i++) {\n    sum += array[i];\n  }\n  return sum;\n}\n\nexport function randomWeightedElem<T>(\n  array: T[],\n  weight: WeightFn<T>\n): T | undefined {\n  if (array.length === 0) return undefined;\n\n  const weights = array.map(weight);\n  let selected = randomInt(sum(weights));\n  for (let i = 0; i < weights.length; i++) {\n    selected -= weights[i];\n    if (selected < 0) return array[i];\n  }\n\n  return array[array.length - 1];\n}\n\nexport function lerp(source: number, target: number, amount: number): number {\n  return source * amount + target * (1 - amount);\n}\n","import { Unit, Board, Tile } from '../core';\nimport { doWorkWhile, moveTowards } from './actions';\nimport { randomWeightedElem, WeightFn } from '../util/util';\n\nfunction canDoWork(unit: Unit): boolean {\n  const curTile = unit.tile;\n  if (!curTile) return false;\n\n  if (curTile.occupancy[unit.owner.opponent.id] > 0) {\n    // enemy spotted\n    return true;\n  }\n\n  if (curTile.owner === unit.owner.opponent) {\n    // enemy tile, try to destroy it\n    return true;\n  }\n\n  if (curTile.owner === unit.owner && curTile.healthProportion() < 0.99) {\n    // repair owned tile\n    return true;\n  }\n\n  if (curTile === unit.owner.homeTile && unit.isDamaged()) {\n    // heal here\n    return true;\n  }\n\n  return false;\n}\n\nexport function* randomWalkAI(\n  unit: Unit,\n  board: Board,\n  tilePref: WeightFn<Tile>\n) {\n  function nextTile(): Tile {\n    if (unit.isDamaged()) {\n      return board.neighbourClosestTo(unit.tile, unit.owner.homeTile);\n    }\n    const next = randomWeightedElem(board.neighbours(unit.tile), tilePref);\n    return next || unit.owner.homeTile;\n  }\n\n  while (true) {\n    if (canDoWork) {\n      yield* doWorkWhile(unit, canDoWork);\n    }\n\n    // TODO Turn and rotate first\n    yield* moveTowards(unit, nextTile().toPos(), canDoWork);\n  }\n}\n\nexport function* offensiveUnitAI(unit: Unit, board: Board) {\n  yield* randomWalkAI(unit, board, (t) => {\n    const diff = Math.abs(unit.owner.id - t.owner.id) + 1;\n    return diff * diff * diff;\n  });\n}\n\nexport function* defensiveUnitAI(unit: Unit, board: Board) {\n  yield* randomWalkAI(unit, board, (t) => {\n    const diff = 2 - Math.abs(unit.owner.id - t.owner.id) + 1;\n    return diff * diff * diff;\n  });\n}\n","import { Mesh, MeshBuilder, Scene } from '@babylonjs/core';\nimport { defensiveUnitAI, offensiveUnitAI } from '../ai/randomWalk';\nimport { Unit } from './unit';\nimport { Board } from './board';\nimport { randomElem } from '../util/util';\nimport { UnitProductionStrategy, UnitType } from './types';\n\nconst offenseUT: UnitType = {\n  id: 0,\n  displayName: 'Offensive',\n  maxHealth: 10,\n\n  maxSpeed: 1.5,\n  attackVsUnit: 4,\n  attackVsTile: 2,\n  repairTile: 0.5,\n  repairSelf: 0.5,\n\n  meshFactory: offensiveMeshFactory,\n  aiFactory: offensiveAIFactory,\n};\n\nconst defenseUT: UnitType = {\n  id: 1,\n  displayName: 'Defensive',\n  maxHealth: 15,\n\n  maxSpeed: 2,\n  attackVsUnit: 3,\n  attackVsTile: 0.25,\n  repairTile: 2,\n  repairSelf: 1,\n\n  meshFactory: defensiveMeshFactory,\n  aiFactory: defensiveAIFactory,\n};\n\nfunction offensiveMeshFactory(\n  scene: Scene,\n  radius: number,\n  height: number\n): Mesh {\n  const options = {\n    diameter: 2 * radius,\n    height,\n    tessellation: 3,\n    enclose: true,\n  };\n  return MeshBuilder.CreateCylinder('offUnit', options, scene);\n}\n\nfunction defensiveMeshFactory(\n  scene: Scene,\n  radius: number,\n  height: number\n): Mesh {\n  const options = {\n    diameter: 1.7 * radius,\n    height,\n    tessellation: 5,\n    enclose: true,\n  };\n  return MeshBuilder.CreateCylinder('defUnit', options, scene);\n}\n\nfunction offensiveAIFactory(unit: Unit, board: Board): Generator {\n  return offensiveUnitAI(unit, board);\n}\n\nfunction defensiveAIFactory(unit: Unit, board: Board): Generator {\n  return defensiveUnitAI(unit, board);\n}\n\nconst offenseOnlyUPS: UnitProductionStrategy = {\n  id: 0,\n  displayName: 'Offensive',\n  className: 'off',\n  nextUnitType: () => offenseUT,\n};\n\nconst defenseOnlyUPS: UnitProductionStrategy = {\n  id: 1,\n  displayName: 'Defensive',\n  className: 'def',\n  nextUnitType: () => defenseUT,\n};\n\nconst randomUPS: UnitProductionStrategy = {\n  id: 2,\n  displayName: 'Random',\n  className: 'rand',\n  nextUnitType: () => randomElem([offenseUT, defenseUT])!,\n};\n\nconst rateScale = 1;\nexport default {\n  minDurationState: 0.05 / rateScale, // update state every 50ms\n\n  tileSize: 2, // how large tiles are in reality\n  drawnTileSize: 0.98 * 2, // how large tiles are drawn -- leave space for a gap\n\n  unitCost: 10,\n  tileMaxHealth: 20,\n  homeTileMaxHealth: 50,\n  tileControlThreshold: 0.8, // if the health > maxHealth * threshold, then this tile produces resources for its owner\n  minUnitsToCapture: 2, // need at least 2 units before a tile can be captured\n\n  // all these are in per second\n  resourcesRate: rateScale,\n\n  unitTypes: [offenseUT, defenseUT],\n  unitProdStrategies: [offenseOnlyUPS, defenseOnlyUPS, randomUPS],\n  defaultUPS: randomUPS,\n};\n","import { InstancedMesh, Scene, Vector3 } from '@babylonjs/core';\nimport { randomElem } from '../util/util';\nimport config from './config';\nimport { Game } from './game';\nimport { Player } from './player';\nimport { Unit } from './unit';\n\nexport class Tile {\n  // using q, r, s cubic coords\n  public readonly coords: Vector3;\n  private health: number;\n  private readonly maxHealth: number;\n  public mesh: InstancedMesh;\n  public occupancy: number[];\n\n  public constructor(\n    private readonly game: Game,\n    public owner: Player,\n    public readonly isHome: boolean,\n    public readonly resMult: number,\n    q: number,\n    r: number,\n    s: number | undefined = undefined\n  ) {\n    if (s === undefined) {\n      s = -(q + r);\n    } else if (q + r + s !== 0) {\n      console.error('Attempting to create an invalid Tile', { q, r, s });\n    }\n\n    this.coords = new Vector3(q, r, s);\n    this.mesh = undefined!; // init'd on generate\n    this.maxHealth = isHome ? config.homeTileMaxHealth : config.tileMaxHealth;\n    this.health = isHome ? this.maxHealth : 0;\n    this.occupancy = [0, 0, 0];\n  }\n\n  public generate(scene: Scene) {\n    this.mesh = this.game.view.makeTileMesh(this, scene);\n\n    const r = this.resMult;\n    const d = r < 0.75 ? 3 : 2;\n    const a = (this.coords.x + d) % d;\n    for (let i = 0; i < Tile.directions.length; i++) {\n      if (r > 1.5 || (r < 0.75 && i % 3 === a) || (r >= 0.75 && i % 2 === a)) {\n        this.game.view.makeResourceMesh(this, i, scene);\n      }\n    }\n\n    // const mmesh = MeshBuilder.CreatePlane(\n    //   `tile${this.coords.x}.${this.coords.y}`,\n    //   { size: 2 },\n    //   scene\n    // );\n    // mmesh.rotation.x = Math.PI * 0.5;\n    // mmesh.parent = this.mesh.parent;\n    // mmesh.position = this.mesh.position.clone();\n    // mmesh.position.y += 0.1;\n    //\n    // const texture = AdvancedDynamicTexture.CreateForMesh(mmesh);\n    // let text = ''; //`q ${this.coords.x},   r ${this.coords.y},   s ${this.coords.z}`;\n    // if (this.resMult !== 1) {\n    //   text += ' ==> ' + this.resMult + ' <==';\n    // }\n    //\n    // const button = Button.CreateSimpleButton(\n    //   `but${this.coords.x}.${this.coords.y}`,\n    //   text\n    // );\n    // button.width = 1;\n    // button.height = 0.4;\n    // button.color = 'white';\n    // button.fontSize = 150;\n    // button.background = 'green';\n    // texture.addControl(button);\n  }\n\n  public equals(other: Tile): boolean {\n    return this.coords.equals(other.coords);\n  }\n\n  public healthProportion(): number {\n    return Math.min(1, Math.max(0, this.health / this.maxHealth));\n  }\n\n  public updateDrawn(_elapsed: number) {\n    // nothing needs to be updated per frame\n  }\n\n  public updateState(elapsed: number) {\n    const { resourcesRate, tileControlThreshold } = config;\n\n    this.resolveUnits(this.game.aliveUnits, elapsed);\n\n    this.mesh.instancedBuffers.color = this.owner.tileColor(\n      this.isHome,\n      this.healthProportion()\n    );\n\n    if (this.healthProportion() > tileControlThreshold) {\n      this.owner.resourceCount += elapsed * resourcesRate * this.resMult;\n    }\n  }\n\n  private incHealth(rate: number, elapsed: number) {\n    const newHealth = this.health + rate * elapsed;\n    this.health = Math.min(this.maxHealth, Math.max(0, newHealth));\n  }\n  public harm(rate: number, elapsed: number) {\n    this.incHealth(-rate, elapsed);\n  }\n  public heal(rate: number, elapsed: number) {\n    this.incHealth(rate, elapsed);\n  }\n\n  private canCapture(occupiers: Unit[]): boolean {\n    return (\n      this.owner === this.game.gaia &&\n      occupiers.length >= config.minUnitsToCapture\n    );\n  }\n\n  private resolveUnits(units: Unit[], elapsed: number) {\n    const unitsOnTile = units.filter((u) => u.tile === this);\n    if (unitsOnTile.length === 0) return;\n\n    const [gaia, p1, p2] = this.game.players;\n    const p1Units = unitsOnTile.filter((u) => u.owner === p1);\n    const p2Units = unitsOnTile.filter((u) => u.owner === p2);\n    this.occupancy = [0, p1Units.length, p2Units.length];\n\n    if (p1Units.length > 0 && p2Units.length > 0) {\n      p1Units.forEach((u) => u.attackUnit(randomElem(p2Units)!, elapsed));\n      p2Units.forEach((u) => u.attackUnit(randomElem(p1Units)!, elapsed));\n    } else {\n      const soleOccupier = unitsOnTile[0].owner;\n      if (this.canCapture(unitsOnTile)) {\n        this.owner = soleOccupier;\n      }\n\n      if (this.owner === soleOccupier) {\n        unitsOnTile.forEach((u) => u.repair(this, elapsed));\n      } else if (this.owner !== gaia) {\n        unitsOnTile.forEach((u) => u.attackTile(this, elapsed));\n        if (this.healthProportion() < 0.1) {\n          this.owner = gaia;\n        }\n      }\n    }\n  }\n\n  public toPosOffset(dir: Vector3, amount: number): Vector3 {\n    // see https://www.redblobgames.com/grids/hexagons/implementation.html#layout\n    const { x, y } = this.coords;\n    let nx = x + dir.x * amount;\n    let ny = y + dir.y * amount;\n\n    return new Vector3(\n      1.5 * nx * config.tileSize,\n      0,\n      sqrt3 * (0.5 * nx + ny) * config.tileSize\n    );\n  }\n\n  public toPos(): Vector3 {\n    return this.toPosOffset(Vector3.Zero(), 0);\n  }\n\n  public static distBetween(a: Tile, b: Tile): number {\n    const { x, y, z } = a.coords.subtract(b.coords);\n    return 0.5 * (Math.abs(x) + Math.abs(y) + Math.abs(z));\n  }\n\n  // increment in CCW order, starting with straight up (north).\n  public static direction = {\n    NN: new Vector3(+0, +1, -1), // north\n    NE: new Vector3(+1, +0, -1), // north east\n    SE: new Vector3(+1, -1, +0), // south east\n    SS: new Vector3(+0, -1, +1), // south\n    SW: new Vector3(-1, +0, +1), // south west\n    NW: new Vector3(-1, +1, +0), // north west\n  };\n  public static directions = [\n    Tile.direction.NN,\n    Tile.direction.NE,\n    Tile.direction.SE,\n    Tile.direction.SS,\n    Tile.direction.SW,\n    Tile.direction.NW,\n  ];\n\n  public static roundCoords(qf: number, rf: number): { q: number; r: number } {\n    const sf = -qf - rf;\n    const q = Math.round(qf);\n    const r = Math.round(rf);\n    const s = Math.round(sf);\n\n    const qDist = Math.abs(qf - q);\n    const rDist = Math.abs(rf - r);\n    const sDist = Math.abs(sf - s);\n\n    if (qDist > Math.max(rDist, sDist)) {\n      return { q: -r - s, r };\n    }\n    if (rDist > sDist) {\n      return { q, r: -q - s };\n    }\n    return { q, r };\n  }\n}\nconst sqrt3 = Math.sqrt(3);\n","import { Scene, Vector3 } from '@babylonjs/core';\nimport config from './config';\nimport { Tile } from './tile';\nimport { Game } from './game';\n\ntype TileFilter = (q: number, r: number, s: number) => boolean;\n\nexport class Board {\n  private readonly tiles: Tile[][]; // indexed by q,r\n  public readonly tileList: Tile[]; // just a list\n\n  constructor(\n    private readonly game: Game,\n    private readonly radius: number, // integer, number of tiles from center\n    acceptTile: TileFilter\n  ) {\n    this.tiles = [];\n    this.tileList = [];\n\n    const R = radius;\n    for (let q = -R; q <= R; q++) {\n      this.tiles[q + R] = [];\n\n      for (let r = -R; r <= R; r++) {\n        const s = -(q + r);\n\n        if (-R <= s && s <= R && acceptTile(q, r, s)) {\n          const isHome = q === 0 && Math.abs(r) === R;\n          const owner = game.players[isHome ? (r === R ? 1 : 2) : 0];\n          const isHomeAdjacent = Math.abs(q) <= 1 && Math.abs(s - r) >= 2;\n          const isMidTile = s === r;\n          const resourceMult =\n            isHome || isMidTile ? 2 : isHomeAdjacent ? 0.5 : 1;\n          const tile = new Tile(game, owner, isHome, resourceMult, q, r);\n          this.tiles[q + R][r + R] = tile;\n          this.tileList.push(tile);\n        }\n      }\n    }\n  }\n\n  public generate(scene: Scene) {\n    for (let i = 0; i < this.tileList.length; i++) {\n      const tile = this.tileList[i];\n      tile.generate(scene);\n    }\n  }\n\n  public updateDrawn(elapsed: number) {\n    for (let i = 0; i < this.tileList.length; i++) {\n      this.tileList[i].updateDrawn(elapsed);\n    }\n  }\n\n  public updateState(elapsed: number) {\n    for (let i = 0; i < this.tileList.length; i++) {\n      this.tileList[i].updateState(elapsed);\n    }\n  }\n\n  public tile(q: number, r: number): Tile | undefined {\n    const R = this.radius;\n    if (-R <= q && q <= R && -R <= r && r <= R) {\n      return this.tiles[q + R][r + R];\n    }\n    return undefined;\n  }\n\n  public neighbours(tile: Tile): Tile[] {\n    return Tile.directions\n      .map((dir) => this.neighbour(tile, dir))\n      .filter((t) => !!t) as Tile[];\n  }\n\n  public neighbourClosestTo(tile: Tile, target: Tile): Tile {\n    const neighbours = this.neighbours(tile);\n    if (neighbours.length === 0) return target;\n\n    const dist = neighbours.map((n) => Tile.distBetween(n, target));\n\n    let closest = 0;\n    for (let i = 1; i < neighbours.length; i++) {\n      if (dist[i] < dist[closest]) closest = i;\n    }\n    return neighbours[closest];\n  }\n\n  public neighbour(tile: Tile, direction: Vector3): Tile | undefined {\n    return this.tile(tile.coords.x + direction.x, tile.coords.y + direction.y);\n  }\n\n  public posToTile(pos: Vector3): Tile | undefined {\n    // see https://www.redblobgames.com/grids/hexagons/implementation.html#layout\n    const x = pos.x / config.tileSize;\n    const z = pos.z / config.tileSize;\n    const { q, r } = Tile.roundCoords((2.0 / 3.0) * x, (sqrt3 * z - x) / 3.0);\n    return this.tile(q, r);\n  }\n}\nconst sqrt3 = Math.sqrt(3);\n","import { Color3, Color4, Scene } from '@babylonjs/core';\nimport config from './config';\nimport { Tile } from './tile';\nimport { Game } from './game';\nimport { UnitProductionStrategy } from './types';\n\nfunction countIf<T>(array: T[], predicate: (t: T) => boolean) {\n  return array.filter(predicate).length;\n}\n\nexport class Player {\n  public readonly stdTileColor: Color4;\n  public readonly homeTileColor: Color4;\n  public readonly fullUnitColor: Color4;\n  public readonly deadUnitColor: Color4;\n  public opponent: Player;\n\n  public homeTile: Tile;\n  public resourceCount: number;\n  public ups: UnitProductionStrategy;\n\n  constructor(\n    private readonly game: Game,\n    public readonly id: number,\n    public readonly name: string,\n    private readonly hue: number,\n    private readonly maxSaturation: number\n  ) {\n    this.stdTileColor = Player.color(hue, 0.4 * maxSaturation, 0.8);\n    this.homeTileColor = Player.color(hue, 0.8 * maxSaturation, 0.6);\n    this.fullUnitColor = Player.color(hue, 0.9 * maxSaturation, 0.95);\n    this.deadUnitColor = Player.color(hue, 0.4 * maxSaturation, 0.3, 0.3);\n\n    this.resourceCount = 0;\n    this.ups = config.defaultUPS;\n    this.homeTile = undefined!; // init'd on generate\n    this.opponent = undefined!; // init'd on generate\n  }\n\n  public generate(_scene: Scene) {\n    this.homeTile = this.game.board.tileList.find(\n      (t) => t.owner === this && t.isHome\n    )!;\n    this.opponent = this.game.players.find(\n      (p) => p.id > 0 && p.id !== this.id\n    )!;\n  }\n\n  public isAlive(): boolean {\n    return this.homeTile.owner === this;\n  }\n\n  public updateState(_elapsed: number) {\n    // automatically spawn unit when there are enough resources\n    while (this.resourceCount > config.unitCost) {\n      this.resourceCount -= config.unitCost;\n      this.game.spawnUnit(this, this.ups.nextUnitType(), this.homeTile);\n    }\n  }\n\n  // ===========================================\n  // Display Specific below -- should perhaps be in a PlayerView class?\n  // ===========================================\n\n  public statusDisplayText(game: Game): string {\n    const resCount = Math.floor(this.resourceCount);\n    const tileCount = countIf(game.board.tileList, (u) => u.owner === this);\n    const unitCount = countIf(game.aliveUnits, (u) => u.owner === this);\n    return `${this.name}: $${resCount}, ${tileCount} tile(s), ${unitCount} unit(s)`;\n  }\n\n  public tileColor(isHome: boolean, healthProportion: number): Color4 {\n    const saturation =\n      (isHome ? 0.8 : 0.4) * healthProportion * this.maxSaturation;\n    const value = isHome ? 0.6 : 0.8;\n    return Player.color(this.hue, saturation, value);\n  }\n\n  private static color(\n    hue: number,\n    saturation: number,\n    value: number,\n    alpha: number = 1\n  ): Color4 {\n    const result = new Color3();\n    Color3.HSVtoRGBToRef(hue, saturation, value, result);\n\n    const { r, g, b } = result;\n    return new Color4(r, g, b, alpha);\n  }\n}\n","import { InstancedMesh, Scene, Vector3 } from '@babylonjs/core';\nimport { Player } from './player';\nimport { Tile } from './tile';\nimport { Game } from './game';\nimport { UnitType } from './types';\n\nexport enum UnitState {\n  active,\n  dead,\n  won,\n  lost,\n}\n\nconst TwoPI = Math.PI * 2;\n\nexport class Unit {\n  public mesh: InstancedMesh;\n  private ai: Generator | undefined;\n  private state: UnitState;\n  public velocity: Vector3;\n  public angularVelocity: number;\n  private targetAngle: number;\n  private health: number;\n\n  constructor(\n    private readonly game: Game,\n    public readonly id: number,\n    public readonly owner: Player,\n    public readonly unitType: UnitType,\n    public tile: Tile,\n    public position: Vector3\n  ) {\n    this.state = UnitState.active;\n    this.velocity = new Vector3();\n    this.angularVelocity = 0;\n    this.targetAngle = 0;\n    this.health = this.unitType.maxHealth;\n\n    // init'd on generate\n    this.mesh = undefined!;\n    this.ai = undefined!;\n  }\n\n  public generate(scene: Scene) {\n    this.mesh = this.game.view.makeUnitMesh(this, scene);\n    this.ai = this.unitType.aiFactory(this, this.game.board);\n  }\n\n  public updateDrawn(elapsed: number) {\n    const minY = 0.05 + this.owner.id * 0.01; // TODO SM just a hack to avoid z-buffer issues\n\n    switch (this.state) {\n      case UnitState.active:\n        this.updatePhysics(elapsed);\n        this.mesh.position.y = minY;\n        break;\n\n      case UnitState.won:\n        this.updatePhysics(elapsed);\n\n        // bobble up & down randomly\n        const amplitude = ((this.id % 3) + 1) * 0.2;\n        const height = amplitude * (0.8 + Math.sin(this.mesh.rotation.y));\n        this.mesh.position.y = minY + Math.max(0, height);\n        break;\n    }\n  }\n\n  private updatePhysics(elapsed: number) {\n    this.velocity.scaleAndAddToRef(elapsed, this.position);\n    this.mesh.position.copyFrom(this.position); // TODO SM interpolate instead of immediate movement\n\n    let rotY = this.mesh.rotation.y + this.angularVelocity * elapsed;\n    if (rotY >= TwoPI) {\n      rotY -= TwoPI;\n    } else if (rotY < 0) {\n      rotY += TwoPI;\n    }\n    this.mesh.rotation.y = rotY;\n  }\n\n  public healthProportion(): number {\n    return this.health / this.unitType.maxHealth;\n  }\n\n  public updateState(elapsed: number) {\n    if (this.health <= 0.001) this.setState(UnitState.dead);\n    if (this.state !== UnitState.active) return;\n\n    this.ai!.next(elapsed);\n    this.tile = this.game.board.posToTile(this.position) || this.owner.homeTile;\n\n    const speed = this.velocity.length();\n    if (speed > 0.1) {\n      const dot = Vector3.Dot(Vector3.Forward(), this.velocity);\n\n      // TODO SM this should be handled by AI\n      this.mesh.rotation.y =\n        Math.PI / 6 + Math.acos(dot / this.velocity.length());\n    }\n\n    this.mesh.scaling.setAll(0.5 + 0.5 * this.healthProportion());\n  }\n\n  private incHealth(rate: number, elapsed: number) {\n    const newHealth = this.health + rate * elapsed;\n    this.health = Math.min(this.unitType.maxHealth, Math.max(0, newHealth));\n  }\n  public harm(rate: number, elapsed: number) {\n    this.incHealth(-rate, elapsed);\n  }\n  public heal(rate: number, elapsed: number) {\n    this.incHealth(rate, elapsed);\n  }\n\n  public attackUnit(target: Unit, elapsed: number) {\n    target.harm(this.unitType.attackVsUnit, elapsed);\n  }\n\n  public attackTile(target: Tile, elapsed: number) {\n    target.harm(this.unitType.attackVsTile, elapsed);\n  }\n\n  public repair(target: Tile, elapsed: number) {\n    target.heal(this.unitType.repairTile, elapsed);\n    if (this.game.canHeal(this, target)) {\n      this.heal(this.unitType.repairSelf, elapsed);\n    }\n  }\n\n  public isAlive(): boolean {\n    return this.state === UnitState.active || this.state === UnitState.won;\n  }\n\n  public isDamaged(): boolean {\n    return this.healthProportion() < 0.99;\n  }\n\n  public setState(state: UnitState) {\n    if (this.state === state) return;\n\n    switch (state) {\n      case UnitState.won:\n        this.velocity.scaleInPlace(0);\n        // spin around on the spot randomly\n        this.angularVelocity = (this.id % 4) * 2 - 3;\n        break;\n\n      case UnitState.dead:\n      case UnitState.lost:\n        this.mesh.instancedBuffers.color = this.owner.deadUnitColor;\n        this.ai = undefined;\n        this.velocity.scaleInPlace(0);\n        this.mesh.position.y = 0.05 + this.owner.id * 0.001; // TODO SM just a hack to avoid z-buffer issues\n        break;\n    }\n    this.state = state;\n  }\n}\n","import {\n  AbstractMesh,\n  ArcRotateCamera,\n  Color3,\n  Color4,\n  HemisphericLight,\n  InstancedMesh,\n  Mesh,\n  MeshBuilder,\n  Scene,\n  ShadowGenerator,\n  StandardMaterial,\n  Vector3,\n} from '@babylonjs/core';\nimport { Game } from './game';\nimport config from './config';\nimport { Tile } from './tile';\nimport { Unit } from './unit';\n\nexport class View {\n  private scene: Scene;\n  private shadows: ShadowGenerator[];\n\n  constructor(private readonly game: Game) {\n    this.scene = undefined!; // init'd on generate\n    this.shadows = [];\n  }\n\n  public generate(scene: Scene) {\n    this.scene = scene;\n\n    scene.ambientColor = new Color3(1, 1, 1);\n\n    const camera = new ArcRotateCamera(\n      'camera1',\n      0,\n      0,\n      10,\n      new Vector3(0, 6, 16),\n      scene\n    );\n    camera.lowerBetaLimit = 0.1;\n    camera.upperBetaLimit = (Math.PI / 2) * 0.8;\n    camera.lowerRadiusLimit = 10;\n    camera.upperRadiusLimit = 100;\n    camera.setTarget(Vector3.Zero());\n\n    const canvas = scene.getEngine().getRenderingCanvas()!;\n    camera.attachControl(canvas, true);\n\n    const lights = [\n      new HemisphericLight('light', new Vector3(0, 1, -2), scene),\n      new HemisphericLight('light', new Vector3(1, 1, 1), scene),\n      new HemisphericLight('light', new Vector3(-1, 1, 1), scene),\n    ];\n    for (let i = 0; i < lights.length; i++) {\n      lights[i].intensity = 0.4;\n    }\n\n    // TODO SM Shadows look poor, needs improvement\n    // this.shadows = lights.map((l) => new ShadowGenerator(1024, l));\n    // for (let i = 0; i < this.shadows.length; i++) {\n    //   this.shadows[i].usePoissonSampling = true; // TODO SM expensive\n    // }\n  }\n\n  private onAddMesh(mesh: AbstractMesh, castShadow: boolean) {\n    if (castShadow) {\n      for (let i = 0; i < this.shadows.length; i++) {\n        this.shadows[i].addShadowCaster(mesh);\n      }\n    }\n  }\n\n  private static tileMesh: Mesh | undefined;\n  private static generateTileMesh(scene: Scene, radius: number): Mesh {\n    const material = new StandardMaterial(`tileMeshMaterial`, scene);\n    material.specularColor = new Color3(0.5, 0.6, 0.87);\n\n    const mesh = MeshBuilder.CreateDisc(\n      `tileMesh`,\n      { radius, tessellation: 6, sideOrientation: Mesh.DOUBLESIDE },\n      scene\n    );\n    mesh.receiveShadows = true;\n\n    mesh.rotation.x = Math.PI * 0.5; // rotate from XY plane to XZ\n    mesh.material = material;\n    mesh.isVisible = false; // hide prototype, only the instanced copies should be visible\n\n    mesh.registerInstancedBuffer('color', 4);\n    mesh.instancedBuffers.color = new Color4(1, 1, 1, 1);\n\n    return mesh;\n  }\n\n  public makeTileMesh(tile: Tile, scene: Scene) {\n    if (!View.tileMesh) {\n      View.tileMesh = View.generateTileMesh(scene, config.drawnTileSize);\n      this.onAddMesh(View.tileMesh, true);\n    }\n\n    const { x, y, z } = tile.coords;\n    const meshInst = View.tileMesh.createInstance(`tileMesh/${x}/${y}/${z}`);\n    meshInst.position.copyFrom(tile.toPos());\n    meshInst.isVisible = true;\n    this.onAddMesh(meshInst, true);\n    return meshInst;\n  }\n\n  private static resourceMesh: Mesh | undefined;\n  private static generateResourceMesh(scene: Scene, radius: number): Mesh {\n    const material = new StandardMaterial(`resMeshMaterial`, scene);\n    material.specularColor = new Color3(0.5, 0.6, 0.87);\n    material.diffuseColor = new Color3(1, 0.9, 0);\n\n    const width = radius;\n    const depth = 0.05;\n    const height = radius;\n    const mesh = MeshBuilder.CreateBox(\n      `resourceMesh`,\n      { width, depth, height },\n      scene\n    );\n\n    mesh.receiveShadows = true;\n\n    mesh.rotation.x = Math.PI * 0.5; // rotate from XY plane to XZ\n    mesh.position.y = 0;\n    mesh.material = material;\n    mesh.isVisible = false; // hide prototype, only the instanced copies should be visible\n    return mesh;\n  }\n\n  public makeResourceMesh(\n    tile: Tile,\n    index: number,\n    scene: Scene\n  ): InstancedMesh {\n    if (!View.resourceMesh) {\n      View.resourceMesh = View.generateResourceMesh(\n        scene,\n        config.drawnTileSize * 0.07\n      );\n      this.onAddMesh(View.resourceMesh, true);\n    }\n\n    const { x, y, z } = tile.coords;\n    const meshInst = View.resourceMesh.createInstance(\n      `resMesh/${x}/${y}/${z}/${index}`\n    );\n\n    const pos = tile.toPosOffset(Tile.directions[index], 0.3);\n    meshInst.position.x = pos.x;\n    meshInst.position.z = pos.z;\n    meshInst.rotation.y = (index * Math.PI) / 6;\n    meshInst.isVisible = true;\n    this.onAddMesh(meshInst, true);\n    return meshInst;\n  }\n\n  private static readonly unitMesh: Mesh[] = [];\n  private static generateUnitMesh(\n    scene: Scene,\n    unit: Unit,\n    radius: number,\n    height: number\n  ): Mesh {\n    const material = new StandardMaterial(`unitMeshMaterial`, scene);\n    material.specularColor = new Color3(0.8, 0.8, 0.9);\n\n    const mesh = unit.unitType.meshFactory(scene, radius, height);\n    mesh.material = material;\n    mesh.isVisible = false; // hide prototype, only instanced meshes are shown\n\n    mesh.registerInstancedBuffer('color', 4);\n    mesh.instancedBuffers.color = new Color4(1, 1, 1, 1);\n\n    return mesh;\n  }\n\n  private unitMeshPrototype(unit: Unit) {\n    const index = unit.unitType.id;\n    if (!View.unitMesh[index]) {\n      View.unitMesh[index] = View.generateUnitMesh(this.scene, unit, 0.4, 0.1);\n      this.onAddMesh(View.unitMesh[index], true);\n    }\n\n    return View.unitMesh[index];\n  }\n\n  public makeUnitMesh(unit: Unit, scene: Scene) {\n    const meshPrototype = this.unitMeshPrototype(unit);\n    const meshInst = meshPrototype.createInstance(`unitMesh/${unit.id}`);\n    meshInst.isVisible = true;\n    meshInst.instancedBuffers.color = unit.owner.fullUnitColor;\n    meshInst.position.copyFrom(unit.position);\n\n    this.onAddMesh(meshInst, true);\n    return meshInst;\n  }\n}\n","import { MutableRefObject } from 'react';\nimport { Scene } from '@babylonjs/core';\nimport config from './config';\nimport { Player } from './player';\nimport { Board } from './board';\nimport { Unit, UnitState } from './unit';\nimport { Tile } from './tile';\nimport { View } from './view';\nimport { UnitType } from './types';\n\nexport type GameStateFn = (game: Game) => void;\ntype GameStateListener = MutableRefObject<GameStateFn | undefined>;\n\nexport class Game {\n  public readonly players: Player[];\n  public readonly gaia: Player;\n  public readonly board: Board;\n  public readonly allUnits: Unit[];\n  public aliveUnits: Unit[];\n  public scene: Scene | undefined;\n  public winner: Player | undefined;\n  public view: View;\n\n  private listeners: GameStateListener[];\n  private elapsedSinceState: number = 0;\n\n  constructor() {\n    this.gaia = new Player(this, 0, 'Gaia', 180, 0.01);\n    const player1 = new Player(this, 1, 'Green', 120, 1);\n    const player2 = new Player(this, 2, 'Red', 0, 1);\n    this.players = [this.gaia, player1, player2];\n\n    this.board = new Board(this, 2, () => true);\n    this.allUnits = [];\n    this.aliveUnits = [];\n    this.view = new View(this);\n    this.scene = undefined;\n    this.winner = undefined;\n    this.listeners = [];\n  }\n\n  public generate(scene: Scene) {\n    this.view.generate(scene);\n\n    this.board.generate(scene);\n    for (let i = 0; i < this.aliveUnits.length; i++) {\n      this.aliveUnits[i].generate(scene);\n    }\n\n    for (let i = 0; i < this.players.length; i++) {\n      const player = this.players[i];\n      player.generate(scene);\n    }\n\n    this.scene = scene;\n    this.reset();\n  }\n\n  public reset() {\n    const [, first, second] = this.players;\n    const firstAdj = this.board.neighbours(first.homeTile);\n    const secondAdj = this.board.neighbours(second.homeTile);\n\n    const [off, def] = config.unitTypes;\n    this.spawnUnit(first, def, first.homeTile);\n    this.spawnUnit(second, def, second.homeTile);\n    this.spawnUnit(first, off, firstAdj[1]);\n    this.spawnUnit(second, off, secondAdj[0]);\n  }\n\n  public spawnUnit(owner: Player, unitType: UnitType, tile: Tile) {\n    const nextId = this.allUnits.length;\n    const unit = new Unit(this, nextId, owner, unitType, tile, tile.toPos());\n    this.scene && unit.generate(this.scene);\n    this.allUnits.push(unit);\n    this.aliveUnits.push(unit);\n  }\n\n  public update(elapsed: number) {\n    this.updateDrawn(elapsed);\n\n    this.elapsedSinceState += elapsed;\n    if (this.running() && this.elapsedSinceState >= config.minDurationState) {\n      this.updateState(this.elapsedSinceState);\n      this.elapsedSinceState = 0;\n    }\n  }\n\n  private updateDrawn(elapsed: number) {\n    if (!this.scene) return;\n\n    this.board.updateDrawn(elapsed);\n    for (let i = 0; i < this.aliveUnits.length; i++) {\n      this.aliveUnits[i].updateDrawn(elapsed);\n    }\n  }\n\n  private updateState(elapsed: number) {\n    this.board.updateState(elapsed);\n    for (let i = 0; i < this.aliveUnits.length; i++) {\n      this.aliveUnits[i].updateState(elapsed);\n    }\n\n    this.aliveUnits = this.allUnits.filter((u) => u.isAlive());\n\n    for (let i = 1; i <= 2; i++) {\n      const player = this.players[i];\n      player.updateState(elapsed);\n      if (!player.isAlive()) {\n        const winner = this.players[3 - i];\n        this.finishGame(winner);\n      }\n    }\n\n    this.notifyListeners();\n  }\n\n  public addGameStateListenerEffect(listener: GameStateListener) {\n    this.listeners.push(listener);\n    return () => {\n      this.listeners = this.listeners.filter((l) => l !== listener);\n    };\n  }\n\n  private notifyListeners() {\n    for (let i = 0; i < this.listeners.length; i++) {\n      const listener = this.listeners[i];\n      listener.current && listener.current(this);\n    }\n  }\n\n  public running(): boolean {\n    return this.winner === undefined;\n  }\n\n  private finishGame(winner: Player) {\n    this.winner = winner;\n\n    for (let i = 0; i < this.aliveUnits.length; i++) {\n      const unit = this.aliveUnits[i];\n      unit.setState(unit.owner === winner ? UnitState.won : UnitState.lost);\n    }\n  }\n\n  public canHeal(unit: Unit, tile: Tile): boolean {\n    return (\n      tile.isHome &&\n      unit.owner === tile.owner &&\n      tile.healthProportion() > config.tileControlThreshold\n    );\n  }\n}\n","import React, { MutableRefObject, useCallback, useEffect, useRef } from 'react';\nimport { Game } from '../core';\nimport { GameRefFn } from './types';\nimport './Alert.css';\n\ntype AlertUIProps = {\n  onGetMessage: (game: Game) => string;\n  outRef: MutableRefObject<GameRefFn | undefined>;\n};\n\nconst AlertUI: React.FC<AlertUIProps> = ({ onGetMessage, outRef }) => {\n  const alertRef = useRef<HTMLDivElement | null>(null);\n\n  const updateAlert = useCallback(\n    (game: Game) => {\n      if (alertRef.current) {\n        alertRef.current.innerText = onGetMessage(game);\n      }\n    },\n    [alertRef, onGetMessage]\n  );\n\n  useEffect(() => {\n    outRef.current = updateAlert;\n  }, [outRef, updateAlert]);\n\n  return <div className=\"alert\" ref={alertRef} />;\n};\n\nexport default AlertUI;\n","import React, {\n  MutableRefObject,\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from 'react';\nimport './ControlPanel.css';\nimport { config, Game, Player } from '../core';\nimport { GameRefFn } from './types';\nimport { UnitProductionStrategy } from '../core/types';\n\ntype ControlPanelBtnProps = {\n  className: string;\n  active: boolean;\n  onClick: () => void;\n};\nconst ControlPanelBtn: React.FC<ControlPanelBtnProps> = ({\n  className,\n  active,\n  onClick,\n}) => {\n  const fullClassName = `control-panel-btn control-panel-btn-${className}`;\n  return (\n    <button className={fullClassName} onClick={onClick} disabled={active} />\n  );\n};\n\ntype ControlPanelStrategyBtnProps = {\n  btnUps: UnitProductionStrategy;\n  curUps: UnitProductionStrategy;\n  onSet: (ups: UnitProductionStrategy) => void;\n};\nconst ControlPanelStrategyBtn: React.FC<ControlPanelStrategyBtnProps> = ({\n  btnUps,\n  curUps,\n  onSet,\n}) => (\n  <ControlPanelBtn\n    className={btnUps.className}\n    active={btnUps === curUps}\n    onClick={() => onSet(btnUps)}\n  />\n);\n\ntype ControlPanelProps = {\n  player: Player;\n  position: 'left' | 'right';\n  outRef: MutableRefObject<GameRefFn | undefined>;\n};\n\nconst ControlPanelUI: React.FC<ControlPanelProps> = ({\n  player,\n  position,\n  outRef,\n}) => {\n  const playerRef = useRef<HTMLDivElement | null>(null);\n  const [ups, setUps] = useState<UnitProductionStrategy>(player.ups);\n\n  const updatePlayerStatus = useCallback(\n    (game: Game) => {\n      if (playerRef.current) {\n        playerRef.current.innerText = player.statusDisplayText(game);\n      }\n    },\n    [playerRef, player]\n  );\n\n  useEffect(() => {\n    if (outRef) {\n      outRef.current = updatePlayerStatus;\n    }\n  }, [outRef, updatePlayerStatus]);\n\n  useEffect(() => {\n    player.ups = ups;\n  }, [player, ups]);\n\n  const className = `control-panel control-panel-${position}`;\n  return (\n    <div className={className}>\n      <div className=\"stats-p1\" ref={playerRef} />\n      {config.unitProdStrategies.map((btnUps) => (\n        <ControlPanelStrategyBtn\n          key={btnUps.id}\n          btnUps={btnUps}\n          curUps={ups}\n          onSet={setUps}\n        />\n      ))}\n    </div>\n  );\n};\n\nexport default ControlPanelUI;\n","import React from 'react';\nimport SceneComponent from 'babylonjs-hook';\nimport { Game } from '../core';\nimport './GameScene.css';\nimport { Scene } from '@babylonjs/core';\n\ntype GameSceneProps = {\n  game: Game;\n};\n\nconst GameSceneUI: React.FC<GameSceneProps> = ({ game }) => {\n  const onRender = (scene: Scene) => {\n    // if its been more than 50ms since last update, either we're on a really slow machine,\n    //  or we've paused for some reason (e.g. inactive tab). Either way, don't attempt to\n    //  simulate physics for all elapsed time, it would result in units moving too much and\n    //  breaking through collision barriers\n    const maxElapsedMillis = 50;\n    const actualElapsedMillis = scene.getEngine().getDeltaTime();\n    const elapsedMillis = Math.min(maxElapsedMillis, actualElapsedMillis);\n    game.update(elapsedMillis / 1000.0);\n  };\n\n  return (\n    <SceneComponent\n      antialias\n      onSceneReady={(scene) => game.generate(scene)}\n      onRender={onRender}\n      id=\"game-canvas\"\n    />\n  );\n};\n\nexport default GameSceneUI;\n","import React, { MutableRefObject, useCallback, useEffect, useRef } from 'react';\nimport { Game } from '../core';\nimport { GameRefFn } from './types';\nimport './Stats.css';\n\ntype StatsUIProps = {\n  outRef: MutableRefObject<GameRefFn | undefined>;\n};\n\nconst StatsUI: React.FC<StatsUIProps> = ({ outRef }) => {\n  const fpsRef = useRef<HTMLDivElement | null>(null);\n\n  const updateStats = useCallback(\n    (game: Game) => {\n      if (game.scene && fpsRef.current) {\n        const fps = Math.round(game.scene.getEngine().getFps());\n\n        // const text = game.board.tileList\n        //   .map((t) => Math.round(t.healthProportion() * 10) / 10)\n        //   .join(' ');\n\n        fpsRef.current.innerText = `FPS: ${fps}`;\n      }\n    },\n    [fpsRef]\n  );\n\n  useEffect(() => {\n    if (outRef) {\n      outRef.current = updateStats;\n    }\n  }, [outRef, updateStats]);\n\n  return (\n    <div className=\"stats\">\n      <div className=\"stats-fps\" ref={fpsRef} />\n    </div>\n  );\n};\n\nexport default StatsUI;\n","import React, { useEffect, useMemo, useRef } from 'react';\nimport { Game } from './core';\nimport { AlertUI, ControlPanelUI, GameSceneUI, StatsUI } from './ui';\nimport { GameRefFn } from './ui/types';\nimport './App.css';\n\nfunction App() {\n  const game = useMemo(() => new Game(), []);\n\n  const statsRef = useRef<GameRefFn | undefined>(undefined);\n  const p1Ref = useRef<GameRefFn | undefined>(undefined);\n  const p2Ref = useRef<GameRefFn | undefined>(undefined);\n  const alertRef = useRef<GameRefFn | undefined>(undefined);\n\n  useEffect(() => game.addGameStateListenerEffect(statsRef), [game, statsRef]);\n  useEffect(() => game.addGameStateListenerEffect(p1Ref), [game, p1Ref]);\n  useEffect(() => game.addGameStateListenerEffect(p2Ref), [game, p2Ref]);\n  useEffect(() => game.addGameStateListenerEffect(alertRef), [game, alertRef]);\n\n  const onGetGameOverMessage = (game: Game) =>\n    game.winner ? `${game.winner.name} wins!` : '';\n\n  return (\n    <div className=\"fullscreen\">\n      <StatsUI outRef={statsRef} />\n      <AlertUI onGetMessage={onGetGameOverMessage} outRef={alertRef} />\n      <GameSceneUI game={game} />\n      <ControlPanelUI position=\"left\" player={game.players[1]} outRef={p1Ref} />\n      <ControlPanelUI\n        position=\"right\"\n        player={game.players[2]}\n        outRef={p2Ref}\n      />\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}